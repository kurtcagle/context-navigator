{"version":3,"sources":["src/resources/index.js","src/modalCustomElement.js","src/main.js","src/environment.js","src/aurelia-cookie.js","src/app.js","src/SortedObjectKeysValueConverter.js","src/ObjectKeysValueConverter.js"],"names":["configure","config","ModalCustomElement","Element","el","visible","attached","open","console","log","close","dispatchEvent","CustomEvent","bubbles","cancel","aurelia","use","standardConfiguration","feature","environment","debug","developmentLogging","testing","plugin","start","then","setRoot","AureliaCookie","get","name","cookies","all","set","value","options","str","encode","expiry","expires","Date","setHours","getHours","path","domain","toUTCString","secure","document","cookie","delete","cookieString","parse","obj","pairs","split","pair","i","length","decode","encodeURIComponent","e","decodeURIComponent","SplashScreen","elemPath","startClass","endClass","interval","elements","_elements","Array","from","querySelectorAll","addClass","className","forEach","elem","classList","add","init","splashScreen","App","window","app","params","getQueryParams","oldConfiguration","serverDomain","location","hostname","theme","topBannerMessage","defaultPage","defaultIcon","missingImage","defaultLabel","footer","activeCSS","widgets","output","context","contextLabel","showProperties","linksContent","preferredPredicate","qRefine","qr","cache","q","qGraph","activeGraph","backupGraph","searchData","history","mode","newModalLabel","showAdvancedListOptions","showMenu","sortMode","sortModeStates","label","title","namespace","activeLinkPredicate","visibleLinks","cookieLogin","JSON","loginData","username","password","permissions","status","action","userCurie","userRole","Set","page","pageSize","itemCount","totalPages","wait","templates","server","href","match","client","cardEdit","editMode","tempGraph","tempContext","blocks","loadBlocks","typedMessage","insertTermObj","temp","asImage","image","createTermObj","type","body","user","complianceItem","country","industry","strain","enzyme","product","complianceTest","noItemsMessage","instanceList","constraints","activeConstraint","predicate","object","availableProperties","pageIndex","activeProperty","currentPath","selectedProperty","activePropertyValues","activePredicates","preferredClasses","availableTemplates","hash","substr","newModal","duplicateModal","addPropertyModal","addConstraintModal","editImageModal","insertTermModal","loginModal","userValidated","editImage","src","width","height","alt","align","classAction","activeClass","defaultCard","curie","prefix","ns","datatype","nodeKind","range","cardinality","sourceCurie","externalURL","template","activePredicate","target","filename","graph","predicateEntries","defaultNamespace","activeCard","Object","assign","linkPropertyList","activeLinksData","count","data","numPages","displayFullBody","me","setTimeout","refreshApp","updateClassNamespace","updateConfiguration","updateInstanceList","loadMenu","showTypedMessage","alert","activateClass","fetchContext","newCard","selectGraph","invokeAction","globalActions","find","id","selectedClass","callback","dataOptions","noPush","method","stringify","fetch","uid","blob","json","contextData","content","g","report","unshift","pushState","ciri","predicates","linkPredicates","links","filter","link","map","hasOwnProperty","sort","tabIndex","includes","indexOf","getPreferredClasses","activateTab","reversed","refreshBlocks","validateUserContext","documentElement","scrollTop","addLinkContextMenu","catch","err","contextMenu","CtxMenu","addItem","elt","dataset","addSeperator","newLabel","prompt","setSingletonProperty","deleteCard","launchPage","property","propertyValue","subject","resp","filterListPredicates","termList","fetchSearch","inputSearch","keys","excludes","excludeSet","keysObj","key","has","push","expr","local","resetPage","constraintString","constraint","join","response","prevRefPage","nextRefPage","setPage","sortValue","linkNodes","a","item","trim","b","parseInt","node","url","queryStr","paramStrs","paramStr","paramTerms","paramName","paramValue","slice","displayLiteral","parseFloat","toLocaleString","style","currency","maximumFractionDigits","timeZone","protocol","replace","lines","entries","line","day","time","launchService","launchSeo","pinPage","refresh","launchURL","goBack","back","goForward","wrapArray","arr","wrappedArray","isArray","tokenize","tokenCase","tokens","token","toUpperCase","toLowerCase","reverse","jumpTo","setMode","loadIngestData","getWidgets","editCard","saveCard","internalTerms","extractInternalTerms","text","filterBody","filters","input","boxFilter","listsFilter","evalFilter","tableFilter","parser","DOMParser","parsedHtml","parseFromString","termCuries","getAttribute","ct","p1","p2","p3","query","htmlTemplate","eval","tableId","rows","html","querySelector","innerHTML","$1","iso2Date","isoDate","date","toLocaleDateString","year","month","deleteItem","index","splice","editCardProperties","defaultValue","saveCardProperties","toISOString","termObjs","term","buffer","update","objects","triples","prolog","newRecord","saveDuplicateCardProperties","revertCard","getLinkOptions","values","updateLinkEntry","confirm","encodeURI","revertItem","login","logout","processLogin","ctx","asProperty","preferredProperty","generateEntityId","activeCardImage","plural","templateProperties","templateData","refreshTemplateProperties","duplicateCard","landing","processNewCard","dt","processDuplicateCard","ignorePredicates","triple","startsWith","cleanTitle","summaryFilter","getTerms","results","updateLink","event","srcElement","deleted","tempItem","foundItem","classContext","filterComplianceTest","constraintObj","getDescription","description","getInstanceList","len","addProperty","contextType","setPropertyListValue","activePropertySelected","activeClassSelected","processAddProperty","addExistingPropertyValue","newObject","newConstraint","processAddConstraint","activePropertyValue","objectLabel","removeConstraint","clearConstraints","formatDoc","gui","editor","execCommand","focus","createHyperlink","sLnk","selection","getSelection","toString","setForeColor","evt","setBackColor","setHeading","imageEdit","imageNode","anchorNode","processEditImage","img","cancelEditImage","insertTermDlg","insertTerm","cancelInsertTerm","updateInsertTerm","searchItem","s","prefLabel","updateInsertImage","imageURL","insertCodeBlock","insertVideo","videoURL","videoEmbed","generateVideoLink","createTermDlg","createTermModal","createTerm","ctObj","classify","cancelCreateTerm","hasContent","deleteClassItems","clearClass","message","setImage","file","files","reader","FileReader","addEventListener","result","createImageFile","readAsDataURL","imageData","imageType","filepath","setFile","createFile","fileData","fileType","block","container","selector","css","header","targets","contexts","isNullLink","separator","getValidLink","validLink","summary","setBodyToTemplate","templateCurie","updateConfigurationOld","hostDomain","configuration","titleCase","graphToContext","gvis","graphQ","keyCode","loadSelectedContext","article","getPredicate","contextClass","preferredProperties","childPrefixes","childClasses","childPrefix","childClass","menu","traverseMenu","mainMenu","error","level","subMenus","menuItem","linkLabel","selectMenuItem","convertToRichText","textContent","convertFromRichText","getVideoId","regExpYouTube","regExpVimeo","video","role","typeClass","editClass","topics","topic","doesPredicateExist","getPage","dom","meta","metaElt","hashtag","xp","XPath","getNodes","outerHTML","getFileAsync","docText","getWebPage","SortedObjectKeysValueConverter","toView","prop","ObjectKeysValueConverter"],"mappings":"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","file":"app-bundle.js","sourcesContent":["export function configure(config) {\n  //config.globalResources([]);\n}\n","import { inject } from 'aurelia-framework';\r\n\r\n@inject(Element)\r\nexport class ModalCustomElement {\r\n  \r\n  // refs\r\n  el;\r\n\r\n  // view model properties\r\n  visible = false; // This variable will track the visibility state of the modal.\r\n\r\n  constructor(el) {\r\n    this.el = el;\r\n  }\r\n  \r\n  // Whenever a view is loaded with a modal in it, I want to make sure that the\r\n  // modal's visiblility is set back to hidden.\r\n  attached() {\r\n    this.visible = false;\r\n  }\r\n  \r\n  // I create an open() function. By using view-model.ref in my view model, I will \r\n  // be able to call this function to open the modal.\r\n  open() {\r\n    this.visible = true;\r\n    console.log(\"Modal opened\");\r\n  }\r\n  \r\n  // I also create a close() function. This can be called externally, just like\r\n  // open, but is also called internally by the default \"Close\" button in the\r\n  // footer.\r\n  close() {\r\n    \r\n    // The close function will hide the modal...\r\n    this.visible = false;\r\n\r\n    // ...and dispatch an event on the modal that the view model can listen for.\r\n    this.el.dispatchEvent(\r\n      new CustomEvent('closed', { bubbles: true })\r\n    );\r\n  }\r\n  cancel() {\r\n    \r\n    // The close function will hide the modal...\r\n    this.visible = false;\r\n\r\n    // ...but doesn't dispatch the processing event.\r\n/*    this.el.dispatchEvent(\r\n      new CustomEvent('closed', { bubbles: true })\r\n    );*/\r\n  }\r\n}\r\n","import environment from './environment';\n\nexport function configure(aurelia) {\n  aurelia.use\n    .standardConfiguration()\n    .feature('resources');\n//    .plugin('aurelia-cookie');\n\n  if (environment.debug) {\n    aurelia.use.developmentLogging();\n  }\n\n  if (environment.testing) {\n    aurelia.use.plugin('aurelia-testing');\n  }\n\n  aurelia.start().then(() => aurelia.setRoot());\n}\n","export default {\n  debug: true,\n  testing: true\n};\n","var AureliaCookie = (function () {\r\n    function AureliaCookie() {\r\n    }\r\n    /**\r\n    *\r\n    * Get a cookie by its name\r\n    */\r\n    AureliaCookie.get = function (name) {\r\n        var cookies = this.all();\r\n        if (cookies && cookies[name]) {\r\n            return cookies[name];\r\n        }\r\n        return null;\r\n    };\r\n    /**\r\n    * Set a cookie\r\n    */\r\n    AureliaCookie.set = function (name, value, options) {\r\n        var str = this.encode(name) + \"=\" + this.encode(value);\r\n        if (value === null) {\r\n            options.expiry = -1;\r\n        }\r\n        /**\r\n        * Expiry date in hours\r\n        */\r\n        if (options.expiry >= 0 && !options.expires) {\r\n            var expires = new Date();\r\n            expires.setHours(expires.getHours() + options.expiry);\r\n            options.expires = expires;\r\n        }\r\n        if (options.path) {\r\n            str += \"; path=\" + options.path;\r\n        }\r\n        if (options.domain) {\r\n            str += \"; domain=\" + options.domain;\r\n        }\r\n        if (options.expires) {\r\n            str += \"; expires=\" + options.expires.toUTCString();\r\n        }\r\n        if (options.secure) {\r\n            str += '; secure';\r\n        }\r\n        document.cookie = str;\r\n    };\r\n    /**\r\n    * Deletes a cookie by setting its expiry date in the past\r\n    */\r\n    AureliaCookie.delete = function (name, domain, path) {\r\n        var cookieString = name + \" =;expires=Thu, 01 Jan 1970 00:00:01 GMT;\";\r\n        if (domain) {\r\n            cookieString += \"; domain=\" + domain;\r\n        }\r\n        if (path) {\r\n            cookieString += \"; path=\" + path;\r\n        }\r\n        document.cookie = cookieString;\r\n    };\r\n    /**\r\n    * Get all set cookies and return an array\r\n    */\r\n    AureliaCookie.all = function () {\r\n        return this.parse(document.cookie);\r\n    };\r\n    AureliaCookie.parse = function (str) {\r\n        var obj = {};\r\n        var pairs = str.split(/ *; */);\r\n        var pair;\r\n        if (pairs[0] === '') {\r\n            return obj;\r\n        }\r\n        for (var i = 0; i < pairs.length; ++i) {\r\n            pair = pairs[i].split('=');\r\n            obj[this.decode(pair[0])] = this.decode(pair[1]);\r\n        }\r\n        return obj;\r\n    };\r\n    AureliaCookie.encode = function (value) {\r\n        try {\r\n            return encodeURIComponent(value);\r\n        }\r\n        catch (e) {\r\n            return null;\r\n        }\r\n    };\r\n    AureliaCookie.decode = function (value) {\r\n        try {\r\n            return decodeURIComponent(value);\r\n        }\r\n        catch (e) {\r\n            return null;\r\n        }\r\n    };\r\n    return AureliaCookie;\r\n}());\r\nexport { AureliaCookie };","import { Router } from 'aurelia-router';\nimport {AureliaCookie} from 'aurelia-cookie';\n\nclass SplashScreen {\n  constructor(elemPath,startClass,endClass,interval){\n      this.elemPath = elemPath||'.splashContainer';\n      this.startClass = startClass||'startFade';\n      this.endClass = endClass||'hide';\n      this.interval = interval||4;\n//      this._elements = [];\n    }\n  \n   elements(){\n      let _elements = Array.from(document.querySelectorAll(this.elemPath));\n      console.log(_elements);\n      return _elements\n    }\n  \n  addClass(className){\n   let elements = this.elements();\n    elements.forEach((elem)=>elem.classList.add(className));\n  }\n  \n  init(){\n    console.log(\"init called\")\n    this.addClass(this.startClass); \n    this.addClass(this.endClass)\n  }\n}\n\nlet splashScreen = new SplashScreen();\nconsole.log(splashScreen);\n\n\n\nexport class App {\n  constructor() {\n    //this.userRole = new Set([]);\n    window.app = this;\n    this.params = this.getQueryParams()||{};\n    this.oldConfiguration = \"\";\n    this.serverDomain = document.location.hostname;\n    console.log(this.serverDomain);\n    this.config = {\n      theme:\"blue\",\n      topBannerMessage:`<img src=\"http://cognitiveworlds.com/lib/getImage.sjs?path=/images/image/_TheCagleReportBanner.jpeg\" class=\"topBannerImage\"/>`,\n      defaultPage:\"publisher:_CognitiveWorld\",\n      defaultIcon:\"/lib/getImage.sjs?path=/images/image/_DefaultImage.jpeg\",\n      missingImage:\"/lib/getImage.sjs?path=/images/image/_DefaultImage.jpeg\",\n      defaultLabel:\"Kaleidoscope\",\n      footer:`<div class=\"copyright\">Copyright 2019 Semantical LLC.</div>`,\n      activeCSS:\"\"\n    };\n    // this.contextMenu.attach('body',menuDefinition);\n    //console.log(this.contextMenu);\n//    this.theme = \"blue\";\n//    this.topBannerMessage = `<img src=\"http://cognitiveworlds.com/lib/getImage.sjs?path=/images/image/_TheCagleReportBanner.jpeg\" class=\"topBannerImage\"/>`;    \n//    this.defaultPage = \"publisher:_CognitiveWorld\";\n//    this.defaultIcon = \"/lib/getImage.sjs?path=/images/image/_DefaultImage.jpeg\";\n//    this.missingImage = \"/lib/getImage.sjs?path=/images/image/_DefaultImage.jpeg\";\n//    this.defaultLabel = \"GraCIE\";\n//    this.activeCSS = \"\";\n    this.footer = `<div class=\"copyright\">Copyright 2019 Semantical LLC.</div>`;\n    this.widgets = {output:['Loading ...']};\n    this.context = this.params.context||this.defaultPage;\n    this.contextLabel =\"Loading\";\n    this.showProperties = true;\n    this.linksContent = \"Placeholder\";\n    this.preferredPredicate = \"rdf:type\";\n    this.qRefine = this.params.qr||\"\";\n    this.cache = this.params.cache||\"cached\";\n    this.q  = this.params.q||\"\";\n    this.qGraph = \"\";\n    this.activeGraph = \"\";\n    this.backupGraph = null;\n    this.searchData = {};\n    this.history = [];\n    this.mode=this.params.mode||\"card\";\n    this.newModalLabel = \"\";\n    this.showAdvancedListOptions = true;\n    this.showMenu = false;\n    this.splashScreen = splashScreen;\n    //this.sortMode = \"createdDateDesc\";\n    this.sortMode = \"sortMode:_ModifiedDateDesc\";\n    this.sortModeStates = [\n      {label:\"📆⬇\",value:\"sortMode:_CreatedDateDesc\",title:\"Creation Date Descending\"},\n      {label:\"📆⬆\",value:\"sortMode:_CreatedDateAsc\",title:\"Creation Date Ascending\"},\n      {label:\"🛠⬇\",value:\"sortMode:_ModifiedDateDesc\",title:\"Last Modified Date Descending\"},\n      {label:\"🛠⬆\",value:\"sortMode:_ModifiedDateAsc\",title:\"Last Modified Date Asscending\"},\n      {label:\"A➡Z⬆\",value:\"sortMode:_AlphaAsc\",title:\"Alphanumeric Ascending\"},\n      {label:\"Z➡A⬇\",value:\"sortMode:_AlphaDesc\" ,title:\"Alphanumeric Descending\"},\n      {label:\"📄⬆\",value:\"sortMode:_PageAsc\",title:\"Page Ascending\"},\n      {label:\"📄⬇\",value:\"sortMode:_OrdinalDesc\",title:\"Page Descending\"}\n];\n    this.namespace = '';\n    this.activeLinkPredicate = null;\n    this.visibleLinks = [];\n    \n    let cookieLogin = JSON.parse(AureliaCookie.get(\"login\"));\n    console.log(cookieLogin);\n    this.loginData = cookieLogin?cookieLogin:{username:\"\",password:\"\",permissions:[],status:false,action:\"login\",userCurie:\"\"};\n    this.userRole = new Set(this.loginData.permissions);\n    this.page = 1;\n    this.pageSize = 20;\n    this.itemCount = 0;\n    this.totalPages = 1;\n    this.wait = false;\n    this.templates = {};\n    this.server = (\"\"+document.location.href).match(/\\:\\/\\/localhost/)?\"http://3.84.16.9:8020\":\"\";\n    this.client = (document.location.href).match(/\\:\\/\\/localhost/)?\"\":\"\";\n    this.cardEdit = false;\n    this.editMode = \"view\";\n    this.tempGraph = null;\n    this.tempContext;\n    this.blocks = [];\n    this.loadBlocks();\n    this.typedMessage = '';\n    this.insertTermObj = {label:\"\",value:\"\",temp:\"\",asImage:false,image:\"\"};\n    this.createTermObj =  {title:\"\",temp:\"\",context:\"\",type:\"\",body:\"\",image:\"\",user:\"\"};\n    this.complianceItem={country:\"\", industry:\"\",strain:\"\",enzyme:\"\",product:\"\",complianceTest:\"\",\n      noItemsMessage:`<div><p>No Compliance Tests Exist for this combination.</p><p>While this cannot guarantee that there are no compliance requirements,\n      it does mean that Dupont has not yet developed a compliance test for this contingency, so you should check with regulatory compliance guidelines.</p></div>`};\n    this.instanceList = {};\n    this.instanceList['class:_Class']={};\n    this.instanceList['class:_Class']['rdf:type']=[];\n    this.constraints = [];\n    this.activeConstraint = {predicate:'',object:''}\n    this.availableProperties = [];\n    this.pageIndex =0;\n    this.activeProperty = {};\n    this.currentPath = \"\";\n    this.selectedProperty = null;\n    this.activePropertyValues = [];\n    this.activePredicates = [];\n    this.preferredClasses = [];\n    this.availableTemplates = [];\n    var hash = window.location.hash.substr(1);\n    this.hash = this.mode||hash||\"card\";\n    console.log(this.hash)\n    // refs\n    this.newModal;\n    this.duplicateModal;\n    this.addPropertyModal;\n    this.addConstraintModal;\n    this.editImageModal;\n    this.insertTermModal;\n    this.loginModal \n    this.userValidated = false;\n    this.editImage = {\n      src:\"\",\n      width:\"500px\",\n      height:\"300px\",\n      alt:\"\",\n      title:\"\",\n      align:\"float:left\"\n    }\n/*    this.globalActions=[\n      {label:\"Select an action\",id:\"selectAction\",action:()=>console.log(\"Select an action\")},\n      {label:\"Go To Classes\",id:\"createNewClass\",action:()=>this.fetchContext(\"class:_Class\",\"card\")},\n      {label:\"Go To Properties\",id:\"createNewProperties\",action:()=>this.fetchContext(\"class:_Property\",\"card\")}\n    ];*/\n    this.classAction=\"classAction:_View\";\n    this.activeClass=\"\";\n    this.defaultCard = {title:\"New Card\",body:\"This is a new card.\",image:\"\",curie:\"foo:bar\",prefix:\"\",ns:\"\",datatype:\"\",nodeKind:\"\",\ndomain:\"\",range:\"\",cardinality:\"\",sourceCurie:\"\",externalURL:\"\",template:\"\",activePredicate:\"\",target:\"\",filename:\"\",username:\"\",password:\"\",graph:\"\",predicateEntries:[]};\n    this.defaultNamespace = \"http://semantical.llc/ns/\";\n    this.activeCard = Object.assign(this.defaultCard,{});\n    this.linkPropertyList = {};\n    this.activeLinksData = {count:0,data:[],page:1,pageSize:20,numPages:1};\n    this.displayFullBody = false;\n    let me = this;\n//    this.server = \"\";\n//    this.client = this.server\n    setTimeout(()=>{\n        this.refreshApp();\n//        console.log(\"db\",db);\n//        this.updateInstanceList('class:_Country');\n//        this.updateInstanceList('class:_Industry');\n//        this.updateInstanceList('class:_Strain');\n//        this.updateInstanceList('class:_ComplianceTest');\n      },50);    \n  }\n\n  refreshApp(){\n    this.updateClassNamespace();\n    this.updateConfiguration();\n    this.updateInstanceList('class:_Graph');\n    this.updateInstanceList('class:_Class');\n//    this.updateInstanceList('class:_Property');\n    this.updateInstanceList('class:_Cardinality');\n    this.updateInstanceList('class:_XSD');\n    this.loadMenu('menuItem:_MainMenu','.mainMenu');\n  }\n\n  showTypedMessage() {\n    alert(this.typedMessage);    \n  }\n\n  activateClass(activeClass,classAction){\n    console.log(activeClass,classAction);\n    switch(classAction){\n      case \"classAction:_View\":this.fetchContext(activeClass);break;\n      case \"classAction:_New\":this.newCard(activeClass);break;\n    }\n  }\n\n  selectGraph(graph=this.activeGraph){\n    this.activeGraph = graph;\n    this.updateInstanceList('class:_Class');\n  }\n\n  invokeAction(){\n    this.globalActions.find((action)=>(action.id === this.selectedClass)).action();\n  }\n\n\n  fetchContext(context,hash=\"card\",callback){\n    let dataOptions = {qRefine:'',noPush:false,}\n    if (this.cardEdit){\n      alert(\"You are currently in edit mode. You must save or revert changes first.\");\n      return}\n    var body = this.constraints;\n  \tvar options = {method: 'POST',\n               body: JSON.stringify(body,null,4),\n               mode: 'cors',\n               cache: 'default'};\n    this.wait = true;\n    //this.cache = cacheState;\n  \twindow.fetch(`${this.server}/lib/server.sjs?context=${context}&cache=${this.cache}&uid=${this.loginData.uid}`,options)\n  \t.then((blob)=>blob.json())\n  \t.then((json)=>{\n\n        this.selectedClass = \"\";\n  \t\t\tthis.contextData = json;\n  \t\t\tthis.ns = json[\"@context\"];\n        this.widgets = json.content;\n  \t\t\tthis.g = json[\"graph\"];\n  \t\t\tthis.report = this.g[\"report:_\"]\n  \t\t\tif (!options.noPush){this.history.unshift({context:context,label:this.g[context]['term:prefLabel'][0].value.substr(0,40)});}\n  \t\t\tthis.context = this.report['report:hasContext'][0].value;\n        window.history.pushState({context:this.context}, this.g[this.context]['term:prefLabel'][0].value,`/?context=${this.context}`);\n/*        if (this.g[this.context]['rdf:type'][0].value != 'class:_Class'){\n          if (this.g[this.context].hasOwnProperty('rdfs:subClassOf')){\n            delete this.g[this.context]['rdfs:subClassOf'];\n          }\n        }*/\n  \t\t\tthis.namespace = this.ciri(context);\n//  \t\t\tthis.predicates = this.report['report:hasPredicate']?this.report['report:hasPredicate'].map((predicate)=>predicate.value):[];\n        this.predicates = json.predicates;\n        this.linkPredicates = json.linkPredicates;\n/*        if (this.report.hasOwnProperty('report:hasPredicateNode')){\n          let nodes = this.report['report:hasPredicateNode'].map((node)=>node.value);\n          nodes.forEach((node)=>{\n            //console.log(this.g[node]);\n            let predicate = {\n                curie:this.g[node]['report:hasPredicate'][0].value,\n                label:this.g[node]['report:hasPredicateLabel'][0].value,\n                domain:this.g[node].hasOwnProperty('report:hasPredicateDomain')?this.g[node]['report:hasPredicateDomain'][0].value:\"class:_Term\",\n                domainLabel:this.g[node].hasOwnProperty('report:hasPredicateDomainLabel')?this.g[node]['report:hasPredicateDomainLabel'][0].value:\"Term\",\n                domainPlural:this.g[node].hasOwnProperty('report:hasPredicateDomainPluralLabel')?this.g[node]['report:hasPredicateDomainPluralLabel'][0].value:\"Terms\",\n                range:this.g[node].hasOwnProperty('report:hasPredicateRange')?this.g[node]['report:hasPredicateRange'][0].value:\"class:_Term\",\n                rangeLabel:this.g[node].hasOwnProperty('report:hasPredicateRangeLabel')?this.g[node]['report:hasPredicateRangeLabel'][0].value:\"Term\",\n              }\n              this.predicates.push(predicate);\n          })\n        } */\n  \t\t\tthis.links = this.report['report:hasLink']?this.report['report:hasLink'].filter((link)=>link.value != null).map((link)=>link.value):[];\n        this.page = 1;\n        this.preferredPredicate = this.g[context].hasOwnProperty('term:hasPreferredProperty')?this.g[context]['term:hasPreferredProperty'][0].value:null;\n  \t\t\tthis.sort();\n        //this.refreshTemplateProperties();\n  \t\t\t//this.activeLinkPredicate = predicate;\n        //this.activateTab(this.predicates.map((predicate)=>predicate.curie)[tabIndex],true,true);\n        console.log(tabIndex);\n        console.log(this.predicates);\n        this.activePredicates = this.linkPredicates; //this.filterListPredicates(this.predicates)||[];\n        let tabIndex = this.activePredicates.map((predicate)=>predicate.curie).includes('rdf:type')?this.activePredicates.map((predicate)=>predicate.curie).indexOf('rdf:type'):0;\n        console.log(\"Active Predicates:\",this.activePredicates);\n        let predicate = this.preferredPredicate?this.preferredPredicate:this.activePredicates.length>0?this.activePredicates[tabIndex].curie:'rdf:type';\n        this.getPreferredClasses(this.context);\n        //this.activeLinkPredicate = predicate;\n        setTimeout(()=>{\n          //this.activateTab(predicate,true,options);\n          this.activateTab();\n    \t\t\tthis.qRefine = dataOptions.qRefine||\"\";\n    \t\t\tthis.q = \"\";\n          this.reversed = false;\n          this.wait = false;\n          this.mode = hash;\n          //this.getWidgets();\n          this.refreshBlocks();\n          this.validateUserContext();\n          document.documentElement.scrollTop = 0;\n          this.addLinkContextMenu()\n\n        },500)\n        this.splashScreen.init();\n  \t\t\t//console.log(this.activeLinkPredicate);\n        //console.log(\"************ Predicates\");\n        //console.log(this.predicates)\n  \t\t\t//console.log(json)\n  \t\t})\n  \t.catch((err)=>{\n      console.log(\"Error\");\n      if (!this.g.hasOwnProperty('report:_')){\n        this.fetchContext('page:_404_TermNotFound','card');\n      }\n      else {\n        console.log(err);\n        this.wait = false;\n      }})\n    \n  }\n\n  addLinkContextMenu(){\n          if (Array.from(document.querySelectorAll('.linkContainer.au-target')).length === 0){\n            let contextMenu = CtxMenu('.linkContainer');\n            //Array.from(contextMenu._items).forEach((item)=>{contextMenu.removeItem(item);console.log(item)})\n            contextMenu.addItem(\"Go\",(elt)=>app.fetchContext(elt.dataset.context));\n            contextMenu.addItem(\"Properties\",(elt)=>app.fetchContext(elt.dataset.context,'properties'));\n            contextMenu.addSeperator();\n            contextMenu.addItem(\"Edit Label\",(elt)=>{\n            let newLabel = prompt(\"Please enter the new label:\");  \n            if(newLabel){\n                app.setSingletonProperty(elt.dataset.context,'term:prefLabel',newLabel,'xsd:string');\n                }\n            });\n            contextMenu.addItem(\"Delete\",(elt)=>app.deleteCard(elt.dataset.context,elt.dataset.type));\n            contextMenu.addSeperator();\n            contextMenu.addItem(\"Card in New Pane\",(elt)=>app.launchPage(elt.dataset.context,\"card\"))\n            contextMenu.addItem(\"Properties in New Pane\",(elt)=>app.launchPage(elt.dataset.context,\"properties\"))\n            contextMenu.addSeperator();\n            contextMenu.addItem(\"Set to Draft\",(elt)=>app.setSingletonProperty(elt.dataset.context,'term:hasPublicationStatus','publicationStatus:_Draft'))\n            contextMenu.addItem(\"Set to Published\",(elt)=>app.setSingletonProperty(elt.dataset.context,'term:hasPublicationStatus','publicationStatus:_Published'))\n            console.log(contextMenu);\n        }\n  }\n\n\n  setSingletonProperty(context,property,propertyValue,datatype=null){\n    let options = {method:\"post\",body:JSON.stringify({subject:context,predicate:property,object:propertyValue,datatype:datatype},null,4)};\n    let path = `${this.server}/lib/updateStatement.sjs`;\n    window.fetch(path,options)\n    .then((resp)=>resp.json())\n    .then((json)=>{console.log(json);app.fetchContext(this.context)})\n    .catch((e)=>console.log(e))\n  }\n\n  filterListPredicates(predicates){\n    let termList = ['rdfs:domain','rdfs:range']; //'property:hasDomain','property:hasRange','term:hasPublishingStatus',\n    return predicates != null?predicates.filter((predicate)=>!(termList.includes(predicate.curie))):[];\n  }\n\n  fetchSearch(){\n  if (this.cardEdit){\n      alert(\"You are currently in edit mode. You must save or revert changes first.\");\n      return}\n\n  \tif (this.q != \"\"){\n  \tvar options = {method: 'GET',\n               mode: 'cors',\n               cache: 'default'};\n  \twindow.fetch(`${this.server}/lib/search.sjs?q=${this.q}`,options)\n  \t.then((blob)=>blob.json())\n  \t.then((json)=>{\n        this.mode = 'search';\n        this.searchData = json;\n\n  \t\t\t//console.log(\"startSearch\");\n/*  \t\t\tthis.contextData = json;\n  \t\t\tthis.ns = json[\"@context\"];\n  \t\t\tthis.g = json[\"graph\"];\n  \t\t\tthis.report = this.g[\"report:_\"];\n  \t\t\tthis.history.push(this.context);\n  \t\t\tthis.context = this.report['report:hasContext'][0].value;\n\n  \t\t\tthis.namespace = this.ciri(this.context);\n  \t\t\tthis.predicates = this.report['report:hasPredicate']?this.report['report:hasPredicate'].map((predicate)=>predicate.value):[];\n  \t\t\tthis.links = this.report['report:hasLink']?this.report['report:hasLink'].map((link)=>link.value):[];\n  \t\t\tthis.sort();\n  \t\t\tthis.activateTab(this.predicates[0]);\n  \t\t\tthis.qRefine = \"\";\n  \t\t\t//console.log(this.activeLinkPredicate);\n  \t\t\t//console.log(json)\n  \t\t\t//console.log(\"endSearch\");\n        */\n  \t\t})\n  \t.catch((err)=>console.log(err))\n  \t}\n  }\n\ninputSearch(){\n    if (this.q != \"\"){\n    var options = {method: 'GET',\n               mode: 'cors',\n               cache: 'default'};\n    window.fetch(`${this.server}/lib/search.sjs?q=${this.q}`,options)\n    .then((blob)=>blob.json())\n    .then((json)=>{\n        this.searchData = json;\n        console.log(this.searchData)\n      })\n    .catch((err)=>console.log(err))\n    }\n  }\n\n\n  keys(obj,excludes=[]){\n  \tconsole.log(\"***** Keys\");\n  \tlet excludeSet = new Set(excludes);\n  \tlet keysObj = [];\n  \tfor(var key in obj){\n  \t\t//console.log(obj);\n  \t\t//console.log(key);\n  \t\tif (!excludeSet.has(key)){keysObj.push(key)}\n  \t\t}\n  \t//console.log(keysObj);\t\n  \treturn keysObj.sort();\n  }\n  ciri(expr){\n  \tlet [prefix,local] = expr.split(\":\");\n  \t//console.log(prefix,local);\n  \t//console.log(this.contextData['@context'])\n  \treturn `${this.contextData['@context'][prefix]}${local}`;\n  }\n  activateTab(predicate,resetPage=true,noPush=false,options={}){\n  \t//console.log(`Entering activeTab with predicate = ${predicate}`);\n    //this.activeLinkPredicate = null;\n    if (options.predicate != null){predicate = options.predicate}\n  \tthis.activeLinkPredicate = predicate?predicate:this.activePredicates.length>0?this.activePredicates[0].curie:\"\";\n    this.activeLinkPredicate = this.activeLinkPredicate != ''?this.activeLinkPredicate:(this.g[this.context]['rdf:type'][0].value === 'class:_Class')?\"rdf:type\":\"\";\n    //console.log(\"activeLinkpredicate = \",this.activeLinkPredicate);\n    let sortMode = (this.g[this.context].hasOwnProperty('class:isClassWithPreferredSortMode')&&this.g[this.context]['class:isClassWithPreferredSortMode']!=null)?this.g[this.context]['class:isClassWithPreferredSortMode'][0].value:this.sortMode;\n    //console.log(sortMode);\n    this.sortMode = sortMode;\n    let path = `${this.server}/lib/links.sjs?context=${this.context}&predicate=${this.activeLinkPredicate}&q=${this.qRefine}&page=${this.page}`;\n    path += `&pageSize=${this.pageSize}&sort=${this.sortMode||options.sortMode}`;\n    if (this.constraints.length>0){\n      let constraintString = this.constraints.map((constraint)=>`${constraint.predicate}|${constraint.value}`).join(';');\n      path += `&constraints=${constraintString}`;\n    }\n    this.currentPath = path;\n    window.fetch(path)\n    .then((response)=>response.json())\n    .then((json)=>{\n      //console.log(json);\n      this.activeLinksData = json;\n      this.linksContent = json.content.content||\"\";\n      //console.log(this.linksContent);\n      this.page = json.page;\n      if (resetPage){\n      this.page = 1;\n      }\n      this.totalPages = json.numPages;\n    })\n\n  \t}\n    prevRefPage(){\n      if (this.page > this.totalPages){\n        this.page = this.totalPages;\n      }\n      else {\n        this.page = this.page>1?this.page - 1:1;\n        }\n      this.activateTab(this.activeLinkPredicate,false);\n    }\n    nextRefPage(){\n      if (this.page > this.totalPages){\n          this.page = this.totalPages}\n      else {\n        this.page = this.page<this.totalPages?this.page + 1:this.totalPages;\n      }\n      this.activateTab(this.activeLinkPredicate,false);\n    }\n    setPage(page){\n      this.page = page;\n      this.activateTab(this.activeLinkPredicate,false);      \n    }\n  \tsort(){\n      this.activateTab(this.activeLinkPredicate,false);\n      return null;\n      console.log(this.sortMode);\n      let sortValue;\n  \t\t//console.log(\"Links\");\n  \t\t//console.log(this.links);\n  \t\tthis.links.forEach((link)=>{\n  \t\t\t//console.log(this.g[link]);\n  \t\t\tthis.g[link].link = link;\n  \t\t});\n  \t\tvar linkNodes = this.links.map((link)=>{\n  \t\t\t//console.log(\"Link\");\n  \t\t\t//console.log(link);\n  \t\t\treturn this.g[link]\n  \t\t});\n  \t\t//console.log(this.links);\n  \t\t//console.log(\"entering sort\");\n  \t\tif (linkNodes.length>1){\n        if (this.sortMode === \"sortMode:_AlphaAsc\"){\n            sortValue = (a) => {\n              let item = a[\"term:prefLabel\"][0].value.trim();\n              return item;\n            }\n            linkNodes.sort((a,b)=>sortValue(a) <= sortValue(b)?-1:1)\n        }\n        if (this.sortMode === \"sortMode:_AlphaDesc\"){\n            sortValue = (a) => {\n              let item = a[\"term:prefLabel\"][0].value.trim();\n              return item;\n            }\n            linkNodes.sort((a,b)=>sortValue(a) <= sortValue(b)?1:-1)\n        }\n        if (this.sortMode === \"sortMode:_CreatedDateDesc\"){\n            sortValue = (a)=> a.hasOwnProperty('term:hasCreatedDate')?`${a[\"term:hasCreatedDate\"][0].value}`:\"\";\n            linkNodes.sort((a,b)=> sortValue(a) <= sortValue(b)?1:-1)\n        }\n        if (this.sortMode === \"sortMode:_CreatedDateAsc\"){\n            sortValue = (a)=> a.hasOwnProperty('term:hasCreatedDate')?`${a[\"term:hasCreatedDate\"][0].value}`:\"\";\n            linkNodes.sort((a,b)=> sortValue(a) <= sortValue(b)?-1:1)\n        }\n        if (this.sortMode === \"sortMode:_ModifiedDateAsc\"){\n            sortValue = (a)=> a.hasOwnProperty('term:hasLastModifiedDate')?`${a[\"term:hasLastModifiedDate\"][0].value}`:\"\";\n            linkNodes.sort((a,b)=> sortValue(a) <= sortValue(b)?-1:1)\n\n        }\n        if (this.sortMode === \"sortMode:_OrdinalAsc\"){\n            sortValue = (a)=> a.hasOwnProperty('term:hasOrder')?parseInt(a[\"term:hasOrder\"][0].value):0;\n            linkNodes.sort((a,b)=> sortValue(a) <= sortValue(b)?-1:1)\n\n        }\n        if (this.sortMode === \"sortMode:_OrdinalDesc\"){\n            sortValue = (a)=> a.hasOwnProperty('term:hasOrder')?parseInt(a[\"term:hasOrder\"][0].value):0;\n            linkNodes.sort((a,b)=> sortValue(a) <= sortValue(b)?1:-1)\n\n        }\n\t  \t}\n\t  \t//console.log(\"Link Nodes\");\n  \t\t//console.log(linkNodes);\n  \t\tthis.links=linkNodes.map((node)=>node.link);\n      this.activateTab(this.activeLinkPredicate);\n  \t}\n\n\n\n  \tgetQueryParams(){\n  \t\tvar url = window.document.location.href;\n  \t\tvar queryStr = url.split(\"?\")[1];\n  \t\tvar params = {};\n  \t\tif (queryStr != null){\n  \t\t\tvar paramStrs = queryStr.split(\"&\");\n  \t\t\tparamStrs.forEach((paramStr)=>{\n  \t\t\t\tvar paramTerms = paramStr.split(\"=\");\n  \t\t\t\tvar paramName = paramTerms[0];\n  \t\t\t\tvar paramValue = paramTerms.slice(1).join(\"=\");\n  \t\t\t\tparams[paramName] = paramValue;\n  \t\t\t})\n  \t    return params;\n  \t\t}\n  \t}\n\n  \tdisplayLiteral(item){\n      if (!item){return \"\"}\n      let datatype = item.datatype||\"xsd:string\";\n      switch(datatype){\n        case 'xsd:currency_usd':{return `${parseFloat(item.value).toLocaleString([\"en-us\"],{style:\"currency\",currency:\"USD\"})} USD`};\n        case 'xsd:currency_eur':{return `${parseFloat(item.value).toLocaleString([\"en-us\"],{style:\"currency\",currency:\"EUR\"})}`};\n        case 'xsd:integer':{return parseInt(item.value).toLocaleString([\"en-us\"],{style:\"decimal\",maximumFractionDigits:0})};\n        case 'xsd:float':{return parseFloat(item.value).toLocaleString([\"en-us\"],{style:\"decimal\",maximumFractionDigits:4})};\n        case 'unit:_MilesPerGallon':{return `${parseInt(item.value)} mpg`};\n        case 'unit:_Mile':{return `${parseInt(item.value).toLocaleString([\"en-us\"],{style:\"decimal\",maximumFractionDigits:1})} miles`};\n        case \"xsd:dateTime\":{return `${(new Date(item.value)).toLocaleString([\"en-us\"],{ timeZone: 'UTC' } )}`};\n        case \"xsd:date\":{return `${(new Date(item.value)).toLocaleString([\"en-us\"],{ timeZone: 'UTC' } ).split(/\\, /)[0]}`};\n//          case \"xsd:dateTime\":{return item.value};\n//          case \"xsd:date\":{return item.value};\n        case \"termType:_Image\":return `<a href=\"${item.value}\" target=\"_blank\"><img src=\"${item.value}\" class=\"imageThumbnail\"/></a>`;\n        case \"xsd:textLiteral\":return `<pre>${item.value}</pre>`;\n        case \"xsd:imageURL\":return `<div class=\"internalImageContainer\"><a href=\"${item.value}\" target=\"_blank\"><img src=\"${item.value}\" class=\"link internalImage\"/></a></div>`;\n        case \"xsd:fileURL\":return `<div class=\"internalFileContainer\"><a href=\"${item.value}\" target=\"_blank\">${item.value}</a></div>`;\n        case \"xsd:hexColor\":return `<div class=\"colorSwatchContainer\">\n          <div class=\"colorSwatch\" style=\"background-color:${item.value}\">&nbsp;</div>\n          <div class=\"colorValue\">${item.value}</div>\n          </div>`;\n        case \"xsd:curie\":return `<span class=\"curie\">${item.value}</span>`;\n        case \"xsd:anyURI\":{\n\n          let protocol =  (item.value.match(/^http/))?'':'https://';\n          return `<a href=\"${protocol}${item.value}\" target=\"_blank\" class=\"link\">${item.value.replace(/(http.+?\\/\\/)(.+?\\/).*/,'$1$2...')}</a>`\n            };\n        case \"xsd:email\":return `<a href=\"mailto:${item.value}\" target=\"_blank\" class=\"link\">${item.value}</a>`;\n        case \"xsd:telephone\":return `<a href=\"tel:${item.value.replace(/\\-|\\(|\\)|\\./g,'')}\" target=\"_blank\" class=\"link\">${item.value}</a>`;\n        case \"xsd:anyURL\":return `<a href=\"https://${item.value}\" target=\"_blank\" class=\"link\">${item.value.replace(/(http.+?\\/\\/)(.+?\\/).*/,'$1$2...')}</a>`;\n        case \"identifier:_Email\":return `<a href=\"mailto:${item.value}\" target=\"_blank\" class=\"emailLink\"><span>${item.value}</span></a>`\n        case \"xsd:hours\":{\n          let lines = item.value.split('|');\n          let entries = lines.map((line)=>{\n            if (line != ''){\n              let [day,time] = line.replace(/(.+?)\\:(.+?)/,\"$1#$2\").split(\"#\");\n              day = day.trim();\n              time = time.trim();\n              return `<div class=\"item\"><div class=\"label\">${day}</div><div class=\"value\">${time}</div></div>`\n            }\n            else {return ''}\n          })\n          return `<div class=\"hours\">${entries.join('')}</div>`\n        };\n  \t\t  default: {return `${item.value}`};\n      }\n\n  \t}\n  \tlaunchService(){\n  \t\twindow.open(`${this.server}/lib/server.sjs?context=${this.context}`,'')\n  \t}\n    launchSeo(){\n      window.open(`${this.server}/lib/seo.sjs?context=${this.context}`,'')\n    }\n  \tpinPage(refresh=true,mode=\"card\"){\n      //console.log(this.context);\n  \t\twindow.location.href = `${this.client}/?context=${this.context}${refresh?`&cache=refresh&mode=${this.mode}`:''}`;\n  \t}\n\n  \tlaunchPage(context=this.context,mode=this.mode){\n  \t\twindow.open(`${this.client}/?context=${context}&cache=refresh&mode=${mode}`)\n  \t}\n\n    launchURL(url){\n      window.open(url);\n    }\n\n\n  \tgoBack(){\n      window.history.back();\n  \t}\n\n    goForward(){\n      window.history.back();\n    }    \n  \twrapArray(arr){\n  \t\tlet wrappedArray = Array.isArray(arr)?arr:(arr!=null)?[arr]:[];\n      if (wrappedArray.length > 0){\n        if (wrappedArray[0].type === 'uri'){\n          wrappedArray.sort((a,b)=>a.value > b.value?1:a.value < b.value?-1:0)\n//          wrappedArray.sort((a,b)=>this.g[a.value]['term:prefLabel'][0].value > this.g[b.value]['term:prefLabel'][0].value?1:this.g[a.value]['term:prefLabel'][0].value < this.g[b.value]['term:prefLabel'][0].value?-1:0)\n        }}\n      return wrappedArray;\n  \t}\n\n    tokenize(str,tokenCase = \"title\"){\n      console.log(str);\n      var tokens = str.split(/\\s+/);\n      let expr = tokens.map((token)=>`${token.substr(0,1).toUpperCase()}${token.substr(1)}`).join('');\n      expr = expr.replace(/[^A-z0-9_\\-]/gi,'');\n      if (tokenCase === \"camel\"){\n        console.log(\"TLC #2\");\n        return `${expr.substr(0,1).toLowerCase()}${expr.substr(1)}`;\n        }\n      else {\n        return expr;        \n      }\n    }\n\n    reverse(){\n      this.reversed = ! this.reversed;\n      this.page = 1;\n      this.activateTab(this.activeLinkPredicate);\n    }\n\n    jumpTo(selectedClass){\n        this.qRefine = \"\";\n        this.constraints = [];        \n        this.fetchContext(selectedClass,'card')\n    }\n\n    setMode(mode){\n      if (this.cardEdit){\n         alert(\"You must save or revert changes before changing mode.\")\n      }\n      else {\n        this.mode=mode;\n        this.hash=this.mode;\n        this.refreshBlocks();\n        switch(mode){\n          case \"ingestion\":this.loadIngestData();break;\n          case \"list\":{\n            this.qRefine = \"\";\n            this.constraints = [];\n            if (this.predicates.map((predicate)=>predicate.curie).includes('rdf:type')){\n              console.log(this.predicates);\n              this.activateTab()\n            }\n            break;\n          }\n          case \"widgets\":{\n            break;\n          }\n          default:break\n        }\n      }\n    }\n    getWidgets(){\n      this.widgets = \"<p><b>Loading widgets ...</b></p>\"\n      let path = `/lib/getWidgets.sjs?context=${this.context}`;\n      window.fetch(path)\n      .then((response)=>response.json())\n      .then((json)=>{\n            this.widgets=json;\n        })\n      .catch((e)=>console.log(e))\n\n    }\n\n    loadIngestData(){\n //     console.log(\"Ingest data loaded.\")\n        fetch(`${this.server}/files/analysis.json`)\n        .then((blob)=>blob.json())\n        .then((json)=>{\n          this.templates = json;\n\n        })\n    }\n    editCard(editMode=\"edit\"){\n      this.mode=\"card\";\n       if (editMode === \"edit\"){\n         this.activeCard.title = this.g[this.context]['term:prefLabel'][0].value\n       }\n       else {\n         this.activeCard.title = this.g[this.context]['term:prefLabel'][0].value + \" Copy\";\n         this.activeCard.sourceCurie = this.context;\n       }\n       this.activeCard.body = this.g[this.context]['term:hasDescription']!=null?this.g[this.context]['term:hasDescription'][0].value:\"\";\n       console.log(this.g[this.context].hasOwnProperty('term:hasPrimaryImageURL'));\n       this.activeCard.image = this.g[this.context]['term:hasPrimaryImageURL']!=null?this.g[this.context]['term:hasPrimaryImageURL'][0].value:\"\";\n       this.activeCard.context = this.context;\n       this.activeCard.curie = this.context;\n       console.log(this.g[this.context]['term:hasExternalURL']);\n       this.activeCard.externalURL = this.g[this.context]['term:hasExternalURL']!=null?this.g[this.context]['term:hasExternalURL'][0].value:'';\n       this.cardEdit = true;\n       this.editMode = editMode;\n    }\n\n    saveCard(){\n//       this.g[this.context]['term:prefLabel'][0].value = this.activeCard.title;\n//       this.g[this.context]['term:hasDescription']=[{datatype:\"termType:_HTML\",value:this.activeCard.body,type:\"literal\"}];\n//       this.g[this.context]['term:hasPrimaryImageURL'] = [{datatype:\"termType:_Image\",value:this.activeCard.image,type:\"literal\"}];\n       //this.activeCard.curie = this.context;\n       this.activeCard.context = this.activeCard.curie;\n       let internalTerms = this.extractInternalTerms(this.activeCard.body);\n       let path = `${this.server}/lib/saveCard.sjs`;  \n       console.log(path);\n/*       let options = {\n        headers: {'Content-Type': 'application/json'},\n        body:JSON.stringify(this.activeCard),\n        method:\"post\"};*/\n//        path += `?json=${JSON.stringify(this.activeCard).replace(/\\#/g,\"%%%\")}`;\n        console.log(this.activeCard);\n        window.fetch(path,{body:JSON.stringify(this.activeCard),method:\"POST\"})\n       .then((response)=>response.text())\n       .then((text)=>{\n//          this.pinPage(true,\"card\");\n          this.cache = \"refresh\";\n          this.fetchContext(this.activeCard.curie,\"card\")\n//            console.log(text);\n        })\n       .catch((e)=>console.log(e));\n       this.cardEdit = false;\n    }\n    filterBody(content,filters=['eval','table']){\n      let input = content||\"\";\n      if (input === \"\"){return \"\"}\n      //console.log(`content = ${input}`);\n      filters.forEach((filter)=>{\n      switch(filter){\n        case \"box\": input = this.boxFilter(input);return input;break;\n        case \"lists\": input = this.listsFilter(input);return input;break;\n        case \"eval\": input = this.evalFilter(input);return input;break;\n        case \"table\": input = this.tableFilter(input);return input;break;\n        default: input;\n      }\n    })\n    return input\n  }\n  extractInternalTerms(body){\n    let parser = new DOMParser();\n    let parsedHtml = parser.parseFromString(body, 'text/html');\n    let termCuries = Array.from(parsedHtml.querySelectorAll(\"a\")).filter((node)=>node.getAttribute('property')==='term:hasInternalTerm').map((node)=>node.getAttribute('resource'));\n    return termCuries\n  }\n  \n  boxFilter(input){\n    input = input.replace(/\\[(.*?)\\|(.*?)\\]/g,`<a href=\"?context=$1\">$2</a>`);\n    input = input.replace(/\\*/g,`<li>`); // Replaces *s with list items. Doesn't handle inline * case well\n    return input;\n  }\n\n  tableFilter(input){\n    let context = this.context;\n    let ct = 0;\n    let parser = new DOMParser();\n    input = input.replace(/(\\[macro\\])(.*?)(\\[\\/macro\\])/gi,(match,p1,p2,p3)=>`${p1}${p2.replace(/\\<\\/?div\\>/gi,'').replace(\"&#160;\",\" \",\"g\")}${p3}`);\n    //console.log(input);\n    input = input.replace(/\\[macro\\]\\s*?\\[query\\](.+?)\\[\\/query\\]\\s*?\\[template\\](.+?)\\[\\/template\\]\\s*?\\[style\\](.+?)\\[\\/style\\]\\s*?\\[\\/macro\\]/gi,(match,query,template,style)=>{\n      query = query.replace(/<\\/div><div>/g,'\\n');\n      template = template.replace(/\\&lt;/g,'<').replace(/\\&gt;/g,'>').replace(/&nbsp;/g, \" \").trim();\n      style = style.replace(/\\&lt;/g,'<').replace(/\\&gt;/g,'>').replace(/&nbsp;/g, \" \").trim();\n      console.log(template);\n      let htmlTemplate = eval(template);\n      let options = {method:\"POST\",body:JSON.stringify({query:query})};\n      let path = `${this.server}/lib/clientEval.sjs`;\n      let tableId = `${context.replace(/\\:/,'_')}_table_${ct}`;\n      ct += 1;\n      fetch(path,options)\n      .then((resp)=>resp.json())\n      .then((json)=>{\n        let rows = json;\n        let keys = Object.keys(rows[0]);\n        let html = `<style type=\"css\">${style}</style> ${htmlTemplate(rows,keys)}`;\n        console.log(html);\n        let elem = document.querySelector(`#${tableId}`);\n        elem.innerHTML = html;\n        })\n      .catch((e)=>console.log(e))\n      return `<div id=\"${tableId}\">Loading ...</div>`})\n    return input\n  }\n\n  evalFilter(input){\n    let context = this.context;\n    input = input.replace(/\\[eval\\:(.*?)\\]/g,(match,$1)=>eval($1));\n    return input\n  }\n\n  iso2Date(isoDate){\n    let date = new Date(isoDate);\n    return date.toLocaleDateString(\"en-us\",{ year: 'numeric', month: '2-digit', day: '2-digit' });\n  }\n  deleteItem(index,arr){\n    arr.splice(index,1)\n  }\n  editCardProperties(){\n    console.log(this.g[this.context]);\n    this.tempGraph = Object.assign({},this.g);\n    this.tempContext = this.context;\n    this.cardEdit=true;\n    this.activeCard.title = this.g[this.context]['term:prefLabel'][0].value;\n    this.activeCard.body = this.g[this.context]['term:hasDescription'][0].value;\n\n    this.activeCard.image = this.g[this.context]['term:hasPrimaryImageURL'][0].value;\n    this.activeCard.externalURL = this.g[this.context]['term:hasExternalURL'][0].value;\n    this.activeCard.context = this.context;\n    this.activeCard.curie = this.context;\n    Object.keys(this.g[this.context]).forEach((predicate)=>{\n      if (!Array.isArray(this.g[this.context][predicate])){this.g[this.context][predicate]=[]};\n      this.g[this.context][predicate].forEach((object)=>{\n        if (object.type === \"uri\"){\n          console.log(object.value,this.g.hasOwnProperty(object.value));\n          if (this.g.hasOwnProperty(object.value)){\n            if (this.g[object.value]!=null){\n              object.label = this.g[object.value]['term:prefLabel'][0].value;\n              object.defaultValue = object.value;\n              object.defaultLabel = object.label;\n            }\n          }\n        }\n      })\n    })\n  }\n\n  saveCardProperties(){\n    this.cardEdit = false;\n    let curie = this.activeCard.curie;\n       this.g[this.context]['term:prefLabel'][0].value = this.activeCard.title!= ''?this.activeCard.title:`${this.tokenize((new Date()).toISOString())}`;\n       this.g[this.context]['term:hasDescription']=[{datatype:\"xsd:html\",value:this.activeCard.body,type:\"literal\"}];\n       this.g[this.context]['term:hasPrimaryImageURL'] = [{datatype:\"xsd:imageURL\",value:this.activeCard.image,type:\"literal\"}];\n       this.g[this.context]['term:hasLastModifiedBy'] = [{value:this.loginData.context,type:\"uri\"}];\n/*       if (this.activeCard.sourceCurie != ''){\n         this.g[this.context]['term:hasSourceTerm'] = [{value:this.activeCard.sourceCurie,type:\"uri\"}];\n       }*/\n       this.g[this.context]['term:hasExternalURL']= [{datatype:\"xsd:anyURI\",value:this.activeCard.externalURL,type:\"literal\"}];\n    let internalTerms = this.extractInternalTerms(this.activeCard.body);  \n    let termObjs=internalTerms.map((term)=>{return {value:term,type:\"uri\"}}); \n    console.log(termObjs);\n    this.g[this.context]['term:hasCrossReference']=termObjs\n    let buffer = [];\n    let update = Array.from(Object.keys(this.g[this.context])).forEach((predicate)=>{\n      let objects = this.g[this.context][predicate]||[];\n      Array.from(objects).forEach((object)=>{\n        if (object.type==='uri'){\n          if (!object.value.match(/:_$/)){\n            buffer.push(`${curie} ${predicate} ${object.value}.`)\n          }\n        }\n        else {\n          if (object.value === \"\"){\n            buffer.push(`${curie} ${predicate} \"\"\"${object.value}\"\"\"^^${object.datatype||'xsd:string'}.`)\n          }\n        }\n      })\n    })\n    let triples = buffer.join('\\n');\n    let prolog = Object.keys(this.ns).map((prefix)=>`prefix ${prefix}: <${this.ns[prefix]}>`).join('\\n');\n    let output = `${prolog}\ndelete {${this.context} ?p ?o}\ninsert {\n  ${triples}\n}\nwhere {\n  ${this.context} ?p ?o\n}`;\n  console.log(output)\n  let newRecord = {\"@context\":this.namespace,\"graph\":this.g,subject:this.context,curie:curie};\n  let path = `${this.server}/lib/updateProperties.sjs`;\n  window.fetch(path,{method:\"POST\",body:JSON.stringify(newRecord,null,4)})\n       .then((response)=>response.text())\n       .then((text)=>{\n          //this.pageIndex = this.pageIndex+1;\n          //location.href=`/?context=${context}&index=${this.pageIndex}#properties`;\n//          this.pinPage(true,\"properties\");\n//          this.cache=\"refresh\";\n          this.fetchContext(curie,this.mode||\"card\");\n          //console.log(text);\n        })\n       .catch((e)=>console.log(e));\n  }\n\n  saveDuplicateCardProperties(){\n    this.cardEdit = false;\n    let context = this.activeCard.curie;\n    let curie = this.activeCard.curie;\n       this.g[this.context]['term:prefLabel'][0].value = this.activeCard.title!= ''?this.activeCard.title:`${this.tokenize((new Date()).toISOString())}`;\n       this.g[this.context]['term:hasDescription']=[{datatype:\"xsd:html\",value:this.activeCard.body,type:\"literal\"}];\n       this.g[this.context]['term:hasPrimaryImageURL'] = [{datatype:\"xsd:imageURL\",value:this.activeCard.image,type:\"literal\"}];\n       this.g[this.context]['term:hasExternalURL']= [{datatype:\"xsd:anyURI\",value:this.activeCard.externalURL,type:\"literal\"}];\n    let internalTerms = this.extractInternalTerms(this.activeCard.body);  \n    let termObjs=internalTerms.map((term)=>{return {value:term,type:\"uri\"}}); \n    console.log(termObjs);\n    this.g[this.context]['term:hasCrossReference']=termObjs\n    let buffer = [];\n    let update = Array.from(Object.keys(this.g[this.context])).forEach((predicate)=>{\n      let objects = Array.from(this.g[this.context][predicate]).filter((objects)=>objects!= null);\n      Array.from(this.g[this.context][predicate]).forEach((object)=>{\n        if (object.type==='uri'){\n          buffer.push(`${curie} ${predicate} ${object.value}.`)\n        }\n        else {\n          buffer.push(`${curie} ${predicate} \"\"\"${object.value}\"\"\"^^${object.datatype||'xsd:string'}.`)\n        }\n      })\n    })\n    let triples = buffer.join('\\n');\n    let prolog = Object.keys(this.ns).map((prefix)=>`prefix ${prefix}: <${this.ns[prefix]}>`).join('\\n');\n    let output = `${prolog}\ndelete {${context} ?p ?o}\ninsert {\n  ${triples}\n}\nwhere {\n  optional {\n  ${context} ?p ?o\n  }\n}`;\nconsole.log(output);\n  let newRecord = {\"@context\":this.namespace,\"graph\":this.g,subject:context,curie:curie,query:output};\n  let path = `${this.server}/lib/duplicate.sjs`;\n  window.fetch(path,{method:\"POST\",body:JSON.stringify(newRecord,null,4)})\n       .then((response)=>response.text())\n       .then((text)=>{\n          //this.pageIndex = this.pageIndex+1;\n          //location.href=`/?context=${context}&index=${this.pageIndex}#properties`;\n//          this.pinPage(true,\"properties\");\n//          this.cache=\"refresh\";\n//          this.fetchContext(curie,this.mode||\"card\");\n          //console.log(text);\n        })\n       .catch((e)=>console.log(e));\n  }\n\n\n  revertCard(){\n      this.cardEdit = false;\n      this.g = Object.assign({},this.tempGraph);\n      //console.log(this.context,this.tempContext);\n      //this.context = this.tempContext;\n      //this.pinPage(true,\"card\");\n      this.fetchContext(this.context,\"card\");\n      console.log(\"revertCard() called\");\n  }\n\n  getLinkOptions(property){\n    if (this.linkPropertyList.hasOwnProperty(property)){\n        return this.linkPropertyList[property].values||[];\n      }\n    else {\n        return []\n    }\n  }\n  updateLinkEntry(item,property){\n    if (this.linkPropertyList.hasOwnProperty(property)){\n      let link = this.linkPropertyList[property].values.find((link)=>link.value === item.label);\n      if (link){\n        item.value = link.context;\n      }\n      else {\n        let action = confirm(\"Do you wish this to be a new Entry?\");\n        if (action){\n          item.value = item.value.replace(/^(\\w+):(\\w+)/,`$1:_${this.tokenize(item.label)}`);\n          let prolog = Object.keys(this.ns).map((prefix)=>`prefix ${prefix}: <${this.ns[prefix]}>`).join('\\n');\n          let update = `${prolog}\n  insert data {\n    ${item.value}\n        a ${this.linkPropertyList[property].type};\n        term:prefLabel \"${item.label}\"^^xsd:string;\n        .\n  }`;\n        console.log(update);\n        console.log(\"ToDo: Complete the update of the new entry.\")\n        let path = `${this.server}/lib/updateProperties.sjs?update=${encodeURI(update.replace(/(#)/g,\"%%%\"))}`;\n        window.fetch(path)\n             .then((response)=>response.text())\n             .then((text)=>{\n                this.pinPage(true);\n                console.log(text);\n              })\n             .catch((e)=>console.log(e));\n        }\n        else {\n          this.revertItem(item);\n        }\n      }\n    }\n  }\n  revertItem(item){\n    item.value = item.defaultValue;\n    item.label = item.defaultLabel;\n  }\n\n  login(){\n    this.loginData.action=\"login\";\n    this.loginModal.open();\n  }\n\n  logout(){\n    this.loginData.password = \"\";\n    this.loginData.status = false;\n    this.loginData.action = \"logout\";\n    this.loginData.data = {};\n    let path = `${this.server}/lib/access.sjs`;\n    let params = {method:\"POST\",body:JSON.stringify(this.loginData)};\n    //console.log(params);\n    window.fetch(path,params)\n      .then((response)=>response.json())\n      .then((json)=>{\n        console.log(json);\n          this.loginData  = json;\n          this.userRole = new Set(this.loginData.permissions);\n          AureliaCookie.delete(\"login\");\n          this.cache = \"cached\";\n          this.fetchContext(this.context);\n          this.validateUserContext();          \n      })\n      .catch((e)=>console.log(e));\n  }\n\n\n  processLogin(){\n    let path = `${this.server}/lib/access.sjs`;\n    let params = {method:\"POST\",body:JSON.stringify(this.loginData)};\n    //console.log(params);\n    window.fetch(path,params)\n      .then((response)=>response.json())\n      .then((json)=>{\n          console.log(json);\n          this.loginData  = json;\n          this.userRole = new Set(this.loginData.permissions);\n          if (!this.loginData.status){alert(\"Log-in failed.\")}\n          else {\n            AureliaCookie.set(\"login\",JSON.stringify(this.loginData),{expiry:60,path:'',domain:'',secure:false})\n          }\n      })\n      .catch((e)=>console.log(e));\n  }\n\n\n  newCard(ctx,label=this.newModalLabel,asProperty=false,preferredProperty='',target=''){\n    let context = ctx||this.context;\n    this.context = context;\n    this.generateEntityId(this.context);\n    this.activeCard = Object.assign(this.defaultCard,{});\n    this.activeCard.type = context;\n    this.newModalLabel = label;\n    this.activeCard.title = \"\";\n    this.activeCard.body = \"\";\n    this.activeCard.externalURL = \"\";\n    this.activeCard.user = \"\";\n    this.activeCard.template = \"\";\n//    this.activeCard.domain = context;\n    this.activeCard.image = this.g.hasOwnProperty(context)?Array.isArray(this.g[context]['term:hasPrimaryImageURL'])?this.g[context]['term:hasPrimaryImageURL'][0].value:\"\":\"\";\n    this.activeCard.image = this.activeCardImage||\"\";\n    this.activeCard.activePredicate = preferredProperty;\n    this.activeCard.target = target;\n\n    if (context === 'class:_Class'){\n      this.activeCard.prefix = '';\n      this.activeCard.namespace = '';\n      this.activeCard.plural = '';\n    }\n    if (context === 'class:_Property'){\n      this.activeCard.nodeKind = '';\n      this.activeCard.range = '';\n      this.activeCard.datatype = '';\n      this.activeCard.cardinality = '';\n    }\n    else if (asProperty === true){\n      this.context = \"class:_Property\";\n      this.activeCard.domain = context;\n      this.activeCard.type = \"class:_Property\";\n      this.activeCard.nodeKind = 'nodeKind:_IRI';\n      this.activeCard.range = '';\n      this.activeCard.datatype = '';\n      this.activeCard.cardinality = 'cardinality:_ZeroOrMore';\n \n    }\n/*    let path = `${this.server}/lib/links.sjs?context=class:_Template&constraints=template:hasTarget|${context}`\n    window.fetch(path)\n      .then((response)=>response.json())\n      .then((json)=>{\n        this.availableTemplates = json.data;\n      })\n      .catch((e)=>console.log(e));\n    */\n//    this.availableTemplates = [];\n    /* This gets additional properties appropriate to the class */\n    let path = `${this.server}/lib/newTemplate.sjs?context=${this.context}`\n    window.fetch(path)\n      .then((response)=>response.json())\n      .then((json)=>{\n        this.templateProperties = json.templateData;\n        console.log(this.templateProperties);\n        this.generateEntityId(this.context);\n        Array.from(window.document.querySelectorAll('.modal-body')).forEach((elem)=>elem.scrollTop = 0);\n        this.newModal.open();\n      })\n      .catch((e)=>console.log(e)); \n      this.newModal.open();\n\n  }\n\n  refreshTemplateProperties(){\n    this.availableTemplates = [];\n    let path = `${this.server}/lib/newTemplate.sjs?context=${this.context}`\n    window.fetch(path)\n      .then((response)=>response.json())\n      .then((json)=>{\n        this.predicates = json.templateData;\n        console.log(this.predicates);\n      })\n      .catch((e)=>console.log(e));    \n  } \n\n\n  duplicateCard(){\n    this.revertCard = Object.assign(this.activeCard,{});\n    this.activeCard = {\n      title:`${this.g[this.context]['term:prefLabel'][0].value} Copy`,\n      body:this.g[this.context].hasOwnProperty('term:hasDescription')?this.g[this.context]['term:hasDescription'][0].value:' ',\n      image:this.g[this.context].hasOwnProperty('term:hasPrimaryImageURL')&&Array.isArray(this.g[this.context]['term:hasPrimaryImageURL'])?this.g[this.context]['term:hasPrimaryImageURL'][0].value:' ',\n      curie:`${this.context}_Copy`,\n      sourceCurie:this.context,\n      externalURL:this.g[this.context].hasOwnProperty('term:hasExternalURL')?this.g[this.context]['term:hasExternalURL'][0].value:' ',\n    };\n    this.duplicateModal.open();\n  }\n\n  deleteCard(context = this.context,landing ){\n      landing = (context === this.context)?this.g[context]['rdf:type'][0].value:landing;\n//    let cardType = this.g[context]['rdf:type'][0].value;\n//    let typeLabel = this.g[cardType]['term:prefLabel'][0].value;\n     if (confirm(`Are you sure you wish to delete this item?`)){\n          //console.log(`Delete card ${cardType}`);\n          let path = `${this.server}/lib/deleteCard.sjs?context=${context}`;\n          window.fetch(path)\n            .then((response)=>response.text())\n            .then((text)=>{\n              console.log(text);\n              //location.href =  `${this.client}?context=${cardType}&mode=list&cache=replace`;\n              this.refreshApp();\n              this.fetchContext(landing,\"card\")\n            })\n            .catch((err)=>console.log(err));\n     }  \n  }\n  \n  processNewCard(){\n    console.log(\"processing card\");\n    if (this.activeCard.title === \"\"){\n        let dt = new Date();\n        this.activeCard.title = `${dt}`;\n        this.activeCard.curie += this.tokenize(dt.toISOString());\n      }\n\n    this.activeCard.user = this.loginData.context;\n\n    let prolog = Object.keys(this.ns).map((prefix)=>`prefix ${prefix}: <${this.ns[prefix]}>`).join('\\n');\n        console.log(\"ToDo: Complete the update of the new entry.\");\n\n        if (this.activeCard.prefix != ''){\n           this.ns[this.activeCard.prefix] = this.activeCard.namespace;\n           let path = `${this.server}/lib/updateNamespaces.sjs?prefix=${this.activeCard.prefix}&namespace=${this.activeCard.namespace}&action=add`;\n           window.fetch(path)\n             .then((response)=>response.text())\n             .then((text)=>{\n                console.log(text);\n              })\n             .catch((e)=>console.log(e));\n          }\n        this.activeCard.predicateEntries = [];  \n        this.templateProperties.filter((predicate)=>predicate.value).forEach((predicate)=>this.activeCard.predicateEntries.push(Object.assign(predicate,{})));\n        console.log(\"Predicate Entries\",this.activeCard.predicateEntries);\n        this.activeCard.predicateEntries.filter((property)=>(property.curie === 'term:hasPublicationStatus') && (!property.value || property.value === '')).forEach((property)=>property.value = 'publicationStatus:_Draft');\n        let path = `${this.server}/lib/newCard.sjs`;\n        window.fetch(path,{method:\"POST\",body:JSON.stringify(this.activeCard,null,4)})\n             .then((response)=>response.text())\n             .then((text)=>{\n                console.log(this.activeCard);\n                //location.href =  `${this.client}?context=${this.activeCard.curie}&cache=refresh&mode=card`;\n               // this.refreshApp();\n                this.fetchContext(this.activeCard.curie,'card');\n                //console.log(text);\n              })\n             .catch((e)=>console.log(e));\n  }\n\n  processDuplicateCard(){\n    console.log(\"processing duplicate card\");\n    let ignorePredicates = new Set(['term:prefLabel','term:hasDescription','term:hasPrimaryImageURL','rdf:type']);\n    let prolog = Object.keys(this.ns).map((prefix)=>`prefix ${prefix}: <${this.ns[prefix]}>`).join('\\n');\n    console.log(this.context,this.g[this.context]);\n    let triples = [];\n    var triple;\n    Object.keys(this.g[this.context]).forEach((predicate)=>{\n        if (!ignorePredicates.has(predicate)){\n        this.g[this.context][predicate].forEach((object)=>{\n          if (object.type === 'literal'){\n            triple = `${this.activeCard.curie} ${predicate} ${object.value}.`;\n          }\n          else {\n            triple = `${this.activeCard.curie} ${predicate} \"\"\"${object.value}\"\"\"^^${object.datatype||'xsd:string'}.`;            \n          }\n          triples.push(triple);\n        })\n        }})\n    let update = `${prolog}\n  insert data {\n    ${this.activeCard.curie}\n        a ${this.g[this.context]['rdf:type'][0].value};\n        term:prefLabel \"\"\"${this.activeCard.title}\"\"\"^^xsd:string;\n        term:hasDescription \"\"\"${this.activeCard.body}\"\"\"^^termType:_HTML;\n        term:hasPrimaryImageURL \"${this.activeCard.image}\"^^termType:_Image;\n        term:isDerivedFrom ${this.activeCard.sourceCurie};\n        term:hasExternalURL  \"${this.activeCard.externalURL}\"^^xsd:anyURI;\n        .\n    ${triples.join('\\n')}\n}`;\n        console.log(update);\n        let path = `${this.server}/lib/updateProperties.sjs?update=${encodeURI(update.replace(/(#)/g,\"%%%\"))}`;\n        window.fetch(path)\n             .then((response)=>response.text())\n             .then((text)=>{\n//                location.href =  `${this.client}?context=${this.activeCard.curie}&cache=refresh`\n                console.log(text);\n              })\n             .catch((e)=>console.log(e));\n  }\n\n\n  generateEntityId(context){\n    console.log(`Generate Entity Id - ${context}`)\n    if  (context.startsWith('class:')){\n      let  prefix = this.tokenize(context.replace(/.*\\:_(.+?)$/,\"$1\"),\"camel\");\n      if (context === 'class:_Class'){\n        let cleanTitle = this.summaryFilter(this.activeCard.title,128)\n        var id = this.tokenize(cleanTitle);\n        this.activeCard.curie =  `class:_${id}`;\n        var prefix = this.tokenize(cleanTitle,\"camel\");\n        this.activeCard.prefix = prefix;\n        this.activeCard.namespace = `${this.defaultNamespace}${prefix}/`;\n        this.activeCard.plural = `${this.activeCard.title}s`;\n      }\n      else if (context === 'class:_Property'){\n        let cleanTitle = this.summaryFilter(this.activeCard.title,128)\n        var id = this.tokenize(cleanTitle,\"camel\");\n        var domain = this.tokenize(this.activeCard.domain.replace(/.+?\\:_/,''),'camel');\n\n        var prefix = domain;\n        this.activeCard.curie =  `${prefix}:${id}`;\n        \n      }      \n      else {\n      let cleanTitle = this.activeCard.title;\n      let className = this.context.replace(/.*?\\:_(.+?)$/,\"$1\");\n      console.log(\"TLC #1\");\n      let prefix = `${className.substr(0,1).toLowerCase()}${className.substr(1)}`;\n      console.log(this.activeCard);\n      var id = this.tokenize(cleanTitle);\n      if (id === \"\"){id = this.tokenize((new Date()).toISOString())}\n      this.activeCard.curie = `${prefix}:_${id}`;\n      this.activeCard.title = cleanTitle;\n      }\n    }\n    else {\n      let cleanTitle = this.activeCard.title;\n      let  prefix = this.context.replace(/(.*)\\:_.+?$/,\"$1\");\n      console.log(this.activeCard);\n      var id = this.tokenize(cleanTitle);\n      if (id === \"\"){id = this.tokenize((new Date()).toISOString())}\n      this.activeCard.curie = `${prefix}:_${id}`;\n      this.activeCard.title = cleanTitle;\n    }\n  }\n\n\n  getTerms(property){\n    //console.log(property);\n    let path = `${this.server}/lib/terms.sjs?predicate=${property}`;\n    window.fetch(path)\n       .then((response)=>response.json())\n       .then((json)=>{\n//          console.log(json.results);\n          this.linkPropertyList = {};\n          this.linkPropertyList[property] = json.results;\n          //console.log(this.linkPropertyList[property]);\n       });\n    return [];\n  }\n  updateLink(context,property,item,event){\n    console.log(\"*** updateLink\");\n    //console.log(item.value,event.srcElement.value);\n    let value = event.srcElement.value;\n    console.log(value);\n    if (value === \"delete\"){\n//       delete this.g[context][property].find((tempItem)=>tempItem.value === item.value);\n//       delete this.linkPropertyList[property].find((tempItem)=>event.srcElement.value === tempItem.context);\n//       delete event.srcElement;\n         item.deleted=true;\n      console.log(\"deletes called\");\n    }\n    else {\n        let label = this.linkPropertyList[property].find((tempItem)=>event.srcElement.value === tempItem.context).value;\n        console.log(label);\n        let foundItem = this.g[context][property].find((tempItem)=>tempItem.value === item.value);\n        foundItem.value = value;\n        foundItem.label = label;\n        console.log(foundItem);\n        }\n    //item.value = event.srcElement.value;\n//    item.label = event.srcElement.label;\n\n  }\n  updateClassNamespace(){\n        this.activeCard.namespace = `${this.defaultNamespace}${this.activeCard.prefix}/`;\n\n  }\n  updateInstanceList(classContext,predicate='rdf:type'){\n    let path = `${this.server}/lib/getList.sjs?context=${classContext}&predicate=${predicate}`;\n    path += classContext === 'class:_Class'?`&graph=${this.activeGraph}`:''\n    window.fetch(path)\n       .then((response)=>response.json())\n       .then((json)=>{\n          //console.log(classContext);\n          //console.log(json);\n          //if (!this.instanceList.hasOwnProperty(classContext)){this.instanceList[classContext]={};}\n          this.instanceList[classContext]={};\n          this.instanceList[classContext][predicate]=json;\n       });    \n  }\nfilterComplianceTest(){\n    let classContext = 'class:_ComplianceTest';\n    let predicate = 'rdf:type';\n    let path = `${this.server}/lib/getList.sjs?context=${classContext}&predicate=${predicate}`\n    let constraintObj = {constraints:[]};\n    if (this.complianceItem.country != \"\"){\n      constraintObj.constraints.push({predicate:'complianceTest:hasCountry',object:this.complianceItem.country});\n    }\n    if (this.complianceItem.industry != \"\"){\n      constraintObj.constraints.push({predicate:'complianceTest:hasIndustry',object:this.complianceItem.industry});\n    }\n    console.log(\"Entering Filter Compliance List\");\n    console.log(constraintObj);\n    window.fetch(path,{method:\"POST\",body:JSON.stringify(constraintObj,null,4)})\n       .then((response)=>response.json())\n       .then((json)=>{\n          //console.log(json);\n          //if (!this.instanceList.hasOwnProperty(classContext)){this.instanceList[classContext]={};}\n          this.instanceList[classContext]={};\n          this.instanceList[classContext][predicate]=json;\n       });    \n  }\n\n  getDescription(context,object,predicate){\n      if (context === null || object === null || predicate === null){return \"\"}\n      let item = this.instanceList[object][predicate].find((item)=>item.curie === context);\n      if (item != null){return item.description}\n        else {return \"\"}\n      }\n\n\n  getInstanceList(classContext,predicate='rdf:type'){\n     if (this.instanceList.hasOwnProperty(classContext) && this.instanceList[classContext].hasOwnProperty(predicate)){\n      return this.instanceList\n     }\n     else {\n      return []\n     }\n  }\n\n  summaryFilter(content,len=500){\n    content = content?content:\"\";\n    content = content.replace(/<.+?>/g,' ').replace(/\\s+/g,' ');\n    content = content.substr(0,len);\n    return `${content}`;\n  }\n\n  addProperty(property,context=this.context){\n    //alert(\"Placeholder for add property.\")\n    let contextType = this.g[context]['rdf:type'][0].value;\n    let path = `${this.server}/lib/properties.sjs?type=${contextType}&cache=refresh`;\n    console.log(path);\n    fetch(path)\n    .then((response)=>response.json())\n    .then((json)=>{\n      this.availableProperties = json.results;\n      console.log(this.availableProperties);\n      this.selectedProperty=property;\n      if (property != null){this.setPropertyListValue(property)};  \n      this.addPropertyModal.open();\n    })\n    .catch((e)=>console.log(e))\n  }\n  activePropertySelected(event){\n      let predicate = event.target.value;\n      this.setPropertyListValue(predicate);\n  }\n  setPropertyListValue(predicate){\n    console.log(predicate);  \n    this.activeProperty = this.availableProperties.find((property)=>property.predicate === predicate);\n    console.log(this.activeProperty)\n    if (this.activeProperty.nodeKind === 'nodeKind:_IRI'){\n    let path = `${this.server}/lib/getList.sjs?context=${this.activeProperty.range}&cache=refresh`;\n    fetch(path)\n    .then((response)=>response.json())\n    .then((json)=>{\n      this.activePropertyValues=json;\n\n    })\n    .catch((e)=>console.log(e))\n\n     }\n\n  }\n\n  activeClassSelected(event){\n    console.log(event);\n  }\n\n  processAddProperty(){\n    console.log('*',this.activeProperty);\n    let set = new Set([]);\n    if (this.activeProperty.nodeKind==='nodeKind:_IRI'){\n      if (!this.g[this.context].hasOwnProperty(this.activeProperty.predicate)){\n        this.g[this.context][this.activeProperty.predicate] = [];\n        }\n      if ((new Set(['cardinality:_ZeroOrMore','cardinality:_OneOrMore']).has(this.activeProperty.cardinality))){\n        if (!set.has(this.activeProperty.value)){\n          this.g[this.context][this.activeProperty.predicate].push({'type':'uri',value:this.activeProperty.value});\n          set.add(this.activeProperty.value);\n          }\n        }\n      else {\n          this.g[this.context][this.activeProperty.predicate] = [{'type':'uri',value:this.activeProperty.value}];        \n      }\n      this.saveCardProperties();\n      }\n    if (this.activeProperty.nodeKind==='nodeKind:_Literal'){\n      if (!this.g[this.context].hasOwnProperty(this.activeProperty.predicate)){\n        this.g[this.context][this.activeProperty.predicate] = [];\n        }\n      this.g[this.context][this.activeProperty.predicate].push({'type':'literal',value:this.activeProperty.value,datatype:this.activeProperty.datatype});\n      this.saveCardProperties();\n      }\n  }\n  addExistingPropertyValue(property){\n    let newObject = Object.assign({},this.g[this.context][property][0]);\n    newObject.value = \"\";\n    newObject.label = \"\";\n    this.g[this.context][property].push(newObject);\n\n  }\n\n  newConstraint(){\n    //alert(\"Placeholder for add property.\")\n    let path = `${this.server}/lib/properties.sjs?type=${this.context}&cache=refresh`;\n    console.log(path);\n    fetch(path)\n    .then((response)=>response.json())\n    .then((json)=>{\n      this.availableProperties = json.results;\n      this.activeConstraint.predicate = \"\";\n      this.activeConstraint.object = \"\";\n      this.addConstraintModal.open();\n    })\n    .catch((e)=>console.log(e))\n    }\n\n  processAddConstraint(){\n    console.log(this.activeProperty);\n    let constraint = Object.assign({},this.activeProperty);\n    if (constraint.nodeKind === \"nodeKind:_IRI\"){\n      let propertyValue = this.activePropertyValues.find((activePropertyValue)=>activePropertyValue.curie === constraint.value).label;\n      constraint.objectLabel = propertyValue;\n    }\n    this.constraints.push(constraint);\n    console.log(this.constraints);\n    this.fetchContext(this.context,\"card\");      \n  }\n  removeConstraint(index){\n    this.constraints.splice(index,1);\n    console.log(this.constraints);\n    this.cache=\"refresh\";\n    this.fetchContext(this.context,\"card\");\n  }\n\n  clearConstraints(){\n    this.constraints = [];\n    this.fetchContext(this.context,\"card\");\n  }\n  formatDoc(action,params={},gui=false){\n    let editor = document.querySelector('.bodyEditor');\n    document.execCommand(action,gui,params); editor.focus();\n  }\n  createHyperlink(){\n    var sLnk=prompt('Write the URL here','http://');\n    if(sLnk&&sLnk!=''&&sLnk!='http://'){\n       let editor = document.querySelector('.bodyEditor');\n       let selection = window.getSelection();\n       let text = selection.toString();\n       let link = `<a href=\"${sLnk}\" target=\"_blank\">${text}</a>`;\n       //this.formatDoc('insertHTML',link)}\n       document.execCommand('insertHTML',false,link); \n       editor.focus();\n     }\n  }\n  setForeColor(evt){\n    console.log(evt);\n    this.formatDoc('foreColor',evt.srcElement.value);\n  }\n  setBackColor(evt){\n    console.log(evt);\n    this.formatDoc('backColor',evt.srcElement.value);\n  }\n\n  setHeading(evt){\n    this.formatDoc('formatBlock',evt.srcElement.value);\n    evt.srcElement.value=\"\";\n  }\n  imageEdit(){\n//    this.editImageModal.open();\n      let selection = document.getSelection();\n      let imageNode = selection.anchorNode.querySelector?selection.anchorNode.querySelector(\"IMG\"):null;\n      if (imageNode){\n        this.editImage = {\n          src:imageNode.getAttribute('src'),\n          width:imageNode.getAttribute('width'),\n          height:imageNode.getAttribute('height'),\n          alt:imageNode.getAttribute('alt')||\"\",\n          title:imageNode.getAttribute('title')||\"\",\n          align:imageNode.getAttribute('alignment')||\"\"\n        }\n      }\n      document.execCommand(\"insertHTML\",false,\"%^%\");\n      //this.editImageModal = document.querySelector('.editImageModal');\n      console.log(\"Enter imageEdit\");\n      this.editImageModal.open();\n      console.log(\"Leave imageEdit\");\n//      let url = prompt(\"Image URL\");\n//      this.processEditImage(url);\n  }\n\n\n\n  processEditImage(){\n    console.log(\"Entering processEditImage\");\n    //this.editImageModal.close();\n    let img = `<img src=\"${this.editImage.src}\" class=\"bodyEditorImage ${this.editImage.align}\" alignment=\"${this.editImage.align}\"\n    alt=\"${this.editImage.alt}\" title=\"${this.editImage.title}\" width=\"${this.editImage.width}\" height=\"${this.editImage.height}\"/>`;\n    console.log(img);\n    let editor = document.querySelector('.bodyEditor');\n    editor.focus();\n    //document.execCommand(\"insertHTML\",false,img);\n    let html = editor.innerHTML;\n    editor.innerHTML = html.replace(\"%^%\",img)\n\n    //editor.focus();\n    console.log(\"Leaving processEditImage\");\n  }\n  cancelEditImage(){\n    this.editImageModal.cancel();\n    let editor = document.querySelector('.bodyEditor');\n    //document.execCommand(\"insertHTML\",false,img);\n    let html = editor.innerHTML;\n    editor.innerHTML = html.replace(\"%^%\",\"\")\n\n  }\n\n insertTermDlg(){\n    this.insertTermObj = {label:\"\",value:\"\",temp:\"\",asImage:false,image:\"\"};\n    let editor = document.querySelector('.bodyEditor');\n    let selection = window.getSelection();\n    this.q = selection.toString();\n    this.insertTermObj.temp = selection.toString();\n    this.insertTermObj.label = selection.toString();\n    this.formatDoc('insertHTML',\"%^%\");\n    this.inputSearch()\n    this.insertTermModal.open()\n }\n\n insertTerm(){\n  console.log(\"Entering insertTerm()\");\n  this.q = \"\";\n  let label = this.insertTermObj.temp;\n  console.log(this.insertTermObj.asImage);\n  let link = (this.insertTermObj.asImage===\"image\")?`\n     <div class=\"insertedImageContainer\">\n        <div onclick=\"window.app.fetchContext('${this.insertTermObj.value}','card')\"  class=\"link\"  resource=\"${this.insertTermObj.value}\" property=\"term:hasInternalTerm\">\n          <img src=\"${this.insertTermObj.image}\" class=\"insertedImage\"/>\n          <div class=\"imageCaption\">${this.insertTermObj.temp}</div>\n        </div>\n      </div>`:`<span onclick=\"window.app.fetchContext('${this.insertTermObj.value}','card')\" class=\"link\" resource=\"${this.insertTermObj.value}\" \n      property=\"term:hasInternalTerm\">${label}</span>`;\n  let editor = document.querySelector('.bodyEditor');\n  let html = editor.innerHTML;\n  editor.innerHTML = html.replace(\"%^%\",link)\n  editor.focus();\n }\n\n cancelInsertTerm(){\n  this.q = \"\";\n  let link = this.insertTermObj.temp;\n  let editor = document.querySelector('.bodyEditor');\n  let html = editor.innerHTML;\n  editor.innerHTML = html.replace(\"%^%\",link)\n  //this.insertTermModal.cancel()\n  editor.focus();  \n }\n updateInsertTerm(){\n  let searchItem = this.searchData.results.find((searchItem)=>searchItem.s === this.insertTermObj.value);\n  this.insertTermObj.temp = searchItem.prefLabel;  \n }\n\n  updateInsertImage(){\n  let searchItem = this.searchData.results.find((searchItem)=>searchItem.s === this.insertTermObj.value);\n  this.insertTermObj.image = searchItem.imageURL;\n }\n\n insertCodeBlock(){\n     let editor = document.querySelector('.bodyEditor');\n     editor.focus();\n     document.execCommand('insertHTML',false,'<pre class=\"codeBlock\">// Insert Code Here</pre>');\n }\n\n insertVideo(){\n    let videoURL = window.prompt(\"Enter video URL\");\n//    videoEmbed = videoEmbed.replace(/width=\".*?\"/,`width=\"640\"`).replace(/height=\".*?\"/,`height=\"480\"`);\n     let videoEmbed = this.generateVideoLink(videoURL);\n     let editor = document.querySelector('.bodyEditor');\n     editor.focus();\n\n     document.execCommand('insertHTML',false,videoEmbed);\n }\n\ncreateTermDlg(){\n    this.createTermObj = {label:\"\",curie:\"\",type:\"\",temp:\"\"};\n    let editor = document.querySelector('.bodyEditor');\n    let selection = window.getSelection();\n//    this.q = selection.toString();\n    this.createTermObj.temp = selection.toString();\n    this.createTermObj.title = selection.toString();\n    //this.formatDoc('insertHTML',\"%^%\");\n    //this.inputSearch()\n    this.createTermModal.open()\n}\n\n createTerm(){\n    //console.log(this.createTermObj)\n    let ctObj = this.createTermObj;\n    let cleanTitle = ctObj.title;\n    let className = ctObj.type.replace(/.*?\\:_(.+?)$/,\"$1\");\n    let prefix = `${className.substr(0,1).toLowerCase()}${className.substr(1)}`;\n    var id = this.tokenize(cleanTitle);\n    if (id === \"\"){id = this.tokenize((new Date()).toISOString())}\n    ctObj.curie = `${prefix}:_${id}`;\n    ctObj.title = cleanTitle;\n    ctObj.user = this.loginData.context;\n    ctObj.image = \"\";\n    ctObj.body = ctObj.title;\n    ctObj.predicateEntries = [];\n    console.log(ctObj);\n    let options = {method:\"POST\",body:JSON.stringify(ctObj,null,4)};\n    window.fetch('http://gracie.semanticdatagroup.com/lib/newCard.sjs',options)\n    .then((resp)=>resp.json())\n    .then((json)=>{\n        console.log(json);\n        this.classify();\n    })\n    .catch((e)=>console.log(e))\n\n    /*\n{\"title\":\"Lori Lemaris\",\n \"curie\":\"influencer:_LoriLemaris\",\n \"type\":\"class:_Influencer\",\n \"body\":\"Influencer Lori Lemaris\",\n \"image\":\"\",\n \"user\":\"user:_KurtCagle\",\n \"predicateEntries\":[]\n }\n    */\n }\n\n cancelCreateTerm(){\n\n\n }\n\n\n\n  hasContent(context,property){\n    //console.log(context,property);\n    return (property === 'link')?true:!this.g[context][property][0].value.match(/\\:_$/)\n  }\n  deleteClassItems(clearClass=false){\n    let message = clearClass?`Warning! This will delete the class \"${this.g[this.context]['term:prefLabel'][0].value}\", all properties for that class and all items in the class. It can not be undone. Are you sure you want to continue?`:`Warning! This will remove all items from this class (but keep class and properties). It cannot be undone. Are you sure you want to continue?`;\n    if (confirm(message)){\n      console.log(\"Delete class items\");\n      let path = `${this.server}/lib/deleteClassItems.sjs?context=${this.context}&removeClass=${clearClass?'true':'false'}`;\n      window.fetch(path)\n      .then((response)=>response.text())\n      .then((text)=>{\n          this.cache = \"refresh\";\n          this.fetchContext(\"class:_Class\",'card')\n          })\n      .catch((e)=>console.log(e))\n    }\n  }\n  log(content){\n    console.log(content);\n    return content\n  }\n\n  setImage(event){\n//    console.log(event);\n    //console.log(event.target.value)\n    let file = event.srcElement.files[0];\n    let reader = new FileReader();\n    let target = this.activeCard;\n    let me = this;\n    reader.addEventListener(\"load\", function () {\n      target.image = reader.result;\n      target.filename = file.name;\n          me.createImageFile();\n  }, false);\n    reader.readAsDataURL(file);\n    //this.activeCard.image = window.URL.createObjectURL(file);\n  }\n\n  createImageFile(id=this.activeCard.curie){\n    let url = this.activeCard.image;\n    let name = this.activeCard.filename;\n    if (url.startsWith('data:image')){\n       let type=url.replace(/^data:image\\/(\\w+)\\;.*/,'$1');\n       let data = url.split(';base64,')[1];\n       let options = {\"method\":\"POST\",body:JSON.stringify({imageData:data,imageType:type,id:id,filename:name},null,4)}\n       let target = this.activeCard;\n       window.fetch(`${this.server}/lib/uploadImage.sjs`,options)\n       .then((resp)=>resp.json())\n       .then((json)=>{\n          let path = `${this.server}/lib/getImage.sjs?path=${json.filepath}`;\n          target.image = path;\n        })\n       .catch((e)=>console.log(e))\n    }\n  }\n\n  setFile(event){\n//    console.log(event);\n    //console.log(event.target.value)\n    let file = event.srcElement.files[0];\n    let reader = new FileReader();\n    let target = this.activeCard;\n    let me = this;\n    reader.addEventListener(\"load\", function () {\n      target.externalURL = reader.result;\n      target.filename = file.name;\n      if (target.title != ''){}\n      target.title = target.filename.split('.')[0]\n      console.log(target.filename);\n      me.createFile();\n  }, false);\n    reader.readAsDataURL(file);\n    //this.activeCard.image = window.URL.createObjectURL(file);\n  }\n\n  createFile(id=this.activeCard.curie){\n    let url = this.activeCard.externalURL;\n    let name = this.activeCard.filename;\n    if (url.startsWith('data:')){\n       let type=url.replace(/^data:(.+?)\\;.*/,'$1');\n       let data = url.split(';base64,')[1];\n       let options = {\"method\":\"POST\",body:JSON.stringify({fileData:data,fileType:type,id:id,filename:name},null,4)}\n       let target = this.activeCard;\n       window.fetch(`${this.server}/lib/uploadFile.sjs`,options)\n       .then((resp)=>resp.json())\n       .then((json)=>{\n          let path = `${this.server}/lib/getFile.sjs?path=${json.filepath}`;\n          target.externalURL = path;\n        })\n       .catch((e)=>console.log(e))\n    }\n  }\n\n\n  loadBlocks(){\n/*    this.blocks=[\n{\n      type:\"sp\",\n      predicate:'document:hasAuthor',\n      selector:'byline',\n      html:``,\n      container:'leftPane',\n      header:`<h2>Author(s)</h2>`,\n      footer:``,\n      mode:[\"card\",\"list\"],\n      css:`.authorEntry {padding-bottom:10pt;}\n      .authorImage {\n        width:90%;\n        height:auto;\n        margin-right:10px;\n        margin-bottom:10px;}\n      .jobTitle {font-size:10pt;font-style:italic;}\n      `,\n      template:(context,graph) =>`<div onclick=\"window.app.fetchContext('${context}')\" class=\"authorEntry\">\n        <img src=\"${graph[context]['term:hasPrimaryImageURL'][0].value}\" class=\"authorImage\"/>\n        <div class=\"link\">${graph[context]['term:prefLabel'][0].value}</div>\n        <div class=\"jobTitle\">${graph[context]['author:hasTitle'][0].value}</div>\n        </div>`\n    },\n{\n      type:\"sp\",\n      predicate:'document:hasAuthor',\n      selector:'aboutAuthor',\n      html:``,\n      container:\"centerPaneAddons\",\n      header:``,\n      footer:``,\n      mode:[\"card\"],\n      css:`.aboutAuthor_1 {\n        padding-bottom:10pt;\n        display:flex;\n        flex-direction:row;\n        padding-top:20px;\n      }\n      .authorImage2 {\n        width:90%;\n        height:auto;\n        border:inset 10px lightGray;\n        border-radius:20px;\n\n      }\n      .imageContainer2 {\n        display:block;\n        width:30%;\n        padding:15px;\n      }\n      .authorDescription {font-size:10pt;font-style:italic;display:block;width:70%}\n      `,\n      template:(context,graph) =>`<div onclick=\"window.app.fetchContext('${context}','card')\" class=\"aboutAuthor_1\">\n        <div class=\"imageContainer2\"><img src=\"${graph[context]['term:hasPrimaryImageURL'][0].value}\" class=\"authorImage2\"/></div>\n        <div class=\"authorDescription\">\n        ${graph[context]['term:hasDescription'][0].value}</div>\n        </div>`\n    },\n    {\n      type:\"self\",\n      predicate:\"document:hasTopic\",\n      selector:'topics',\n      separator:', ',\n      html:``,\n      container:'leftPane',\n      header:`<h2>Topic(s)</h2>`,\n      footer:``,\n      mode:[\"card\",\"list\"],\n      css:``,\n      template:(context,graph,index,count) =>`<span onclick=\"window.app.fetchContext('${context}')\" class=\"topic link\">${graph[context]['term:prefLabel'][0].value}</span>`\n    } ,\n    {\n      type:\"self\",\n      predicate:\"page:hasPreviousPage\",\n      selector:'previousPage',\n      separator:'',\n      html:``,\n      container:'leftPane',\n      header:``,\n      footer:``,\n      mode:[\"card\",\"list\"],\n      css:``,\n      template:(context,graph,index,count) =>`<span onclick=\"window.app.fetchContext('${context}')\" class=\"link\">${graph[context]['term:prefLabel'][0].value}</span>`\n    },\n    {\n      type:\"self\",\n      predicate:\"term:hasCrossReference\",\n      selector:'crossRef',\n      separator:'',\n      html:``,\n      container:'leftPane',\n      header:`<h2>Related Topics</h2><ul>`,\n      footer:`</ul>`,\n      mode:[\"card\",\"list\"],\n      css:``,\n      template:(context,graph,index,count) =>`<li><span onclick=\"window.app.fetchContext('${context}')\" class=\"topic link\">${graph[context]['term:prefLabel'][0].value}</span></li>`\n    },\n    {\n      type:\"self\",\n      predicate:\"article:hasOriginalURL\",\n      selector:'originalLink',\n      separator:', ',\n      html:``,\n      container:'leftPane',\n      header:`<h2>Link(s) to Original</h2>`,\n      footer:``,\n      mode:[\"card\",\"list\"],\n      css:``,\n      template:(context,graph,index,count) =>`<div><a class=\"topic link\" target=\"_blank\">${window.app.displayLiteral({value:context,datatype:'xsd:anyURI'})}</a></div>`\n    }\n\n    ] */\n    this.blocks = [];\n\n  }\nrefreshBlocks(){\n    this.blocks.forEach((block)=>{\n      let container = document.querySelector(`.${block.container}`);\n      if (container != null){\n        container.innerHTML = \" \";\n      }\n    })\n    this.blocks.forEach((block)=>{\n      console.log(block.mode)\n      if ((new Set(block.mode)).has(this.mode)){\n      let container = document.querySelector(`.${block.container}`);\n      if (container!=null){\n      if (!container.querySelector(`.${block.selector}`))\n      {\n        container.innerHTML += `<div class=\"${block.selector}\"> </div>`\n      }\n      block.html = `<style type=\"text/css\">${block.css}</style><div class=\"block\">${block.header}`;\n      let targets = Array.from(document.querySelectorAll(`.${block.selector}`));\n      targets.forEach((target)=>target.innerHTML = \"\");\n      console.log(block);\n      if (block.type === \"sp\"){\n        if (this.g[this.context].hasOwnProperty(block.predicate)){\n          let count = this.g[this.context][block.predicate].length;\n          let index = -1;\n          let contexts = this.g[this.context][block.predicate].map((object)=>object.value);\n          contexts.forEach((context)=>{\n          //block.html = block.header;\n          window.fetch(`${this.server}/lib/server.sjs?context=${context}`)\n          .then((response)=>response.json())\n          .then((json)=>{\n            let graph = json.graph;\n            block.html += block.template(context,graph,index,count);\n            index += 1;\n          })\n          .then(()=>{\n              let targets = Array.from(document.querySelectorAll(`.${block.selector}`));\n              if (index + 1 === count){\n                block.html += `${block.footer}</div>`;\n                //console.log(block.html);\n                targets.forEach((target)=>{\n                   target.innerHTML = block.html;\n                  \n              })\n            }\n          })\n      })\n    }\n  }\n      if (block.type === \"self\"){\n        console.log(\"Entering self\");\n        if (this.g[this.context].hasOwnProperty(block.predicate)){\n          console.log(this.g[this.context][block.predicate]);\n          let count = this.g[this.context][block.predicate].length;\n          let index = -1;          \n          let graph = this.g;\n          let contexts = this.g[this.context][block.predicate].map((object)=>object.value);\n          block.html += contexts.map((context)=>!this.isNullLink(context)?block.template(context,graph,index,count):'').join(block.separator);\n          block.html += `${block.footer}</div>`;\n          targets.forEach((target)=>{\n             target.innerHTML = block.html;\n          }) \n\n        }\n      }\n    }\n    }})\n  }\n  isNullLink(context){\n    return (context.match(/:_$/))\n  }\n  getValidLink(context,property){\n    if (this.g[context].hasOwnProperty(property)){\n      let validLink = this.g[context][property].find((value)=>!this.isNullLink(value));\n      return validLink;\n    }\n    else {return false;}\n  }\n  summary(body){\n    if (body!= null){\n        let text = body.replace(/<.+?>/g,'');\n        text = text.substr(0,300);\n        return text.replace(/^(.*)\\..*/,'$1 ...');\n      }\n    else {return \"\"}\n  }\nsetBodyToTemplate(){\n  let templateCurie = this.activeCard.template;\n  if (templateCurie != \"\"){\n    this.activeCard.body = this.availableTemplates.find((template)=>template.link === templateCurie).description;\n    }\n    else {\n      this.activeCard.body = \"\";\n    }\n  }\n  updateConfiguration(){\n          let path = `${this.server}/lib/configure.sjs?host=${this.serverDomain}`;\n          window.fetch(path)\n          .then((response)=>response.json())\n          .then((json)=>{\n            this.config = json;\n            this.config.mode=this.params.mode||this.config.mode;\n            this.context = this.params != null?this.params.context||this.config.defaultPage:this.config.defaultPage;\n\n            this.fetchContext(this.context,this.mode)\n          })\n          .catch((e)=>console.log(e))\n  }\n\n  updateConfigurationOld(){\n    let path = `${this.server}/lib/configure.sjs?host=${this.hostDomain}`;\n    window.fetch(path)\n    .then((response)=>response.json())\n    .then((json)=>{\n      let graph = json.graph;\n      if (graph.hasOwnProperty('class:_Configuration')){\n//        console.log(\"graph\",graph);\n        if (graph[\"class:_Configuration\"].hasOwnProperty('class:hasActiveConfiguration')){\n          let configuration = graph['class:_Configuration']['class:hasActiveConfiguration'][0].value;\n          if (configuration != this.oldConfiguration){\n          this.oldConfiguration = configuration;\n          let path = `${this.server}/lib/server.sjs?context=${configuration}`;\n          window.fetch(path)\n          .then((response)=>response.json())\n          .then((json)=>{\n            let graph = json.graph;\n            this.theme = graph[configuration].hasOwnProperty('configuration:hasTheme')?graph[configuration]['configuration:hasTheme'][0].value:\"\";\n            this.defaultLabel = graph[configuration].hasOwnProperty('configuration:hasSiteName')?graph[configuration]['configuration:hasSiteName'][0].value:\"\";\n            this.defaultIcon = graph[configuration].hasOwnProperty('configuration:hasIcon')?graph[configuration]['configuration:hasIcon'][0].value:\"\";\n            this.defaultPage =  graph[configuration].hasOwnProperty('configuration:hasHomePage')?graph[configuration]['configuration:hasHomePage'][0].value:\"page:_Home\";\n            this.activeCSS =  graph[configuration].hasOwnProperty('configuration:hasCSS')?graph[configuration]['configuration:hasCSS'][0].value:\"\";\n            this.footer =  graph[configuration].hasOwnProperty('configuration:hasFooter')?graph[configuration]['configuration:hasFooter'][0].value:\"\";\n            this.topBannerMessage =   graph[configuration].hasOwnProperty('configuration:hasTopBanner')?graph[configuration]['configuration:hasTopBanner'][0].value:\"\";\n            let mode = graph[configuration].hasOwnProperty('configuration:hasMode')?graph[configuration]['configuration:hasMode'][0].value:\"card\";\n            this.mode=this.params.mode||mode;\n            this.context = this.params != null?this.params.context||this.defaultPage:this.defaultPage;\n\n            this.fetchContext(this.context,this.mode)\n          })\n          .catch((e)=>console.log(e))\n          }}\n        }\n\n    })\n    .catch((e)=>console.log(e))\n  }\n\n\n\n  titleCase(expr){\n    return expr.replace(/(^|\\W)(\\w)/g,(text)=>(text).toUpperCase())\n  }\n  graphToContext(){\n    //window.gvis.loadSelectedContext();\n    let context = window.gvis?window.gvis.context:this.context;\n    this.fetchContext(context,\"card\");\n  }\n  graphQ(event){\n    console.log(event);\n    if (event.keyCode === 13) {\n      window.gvis.loadSelectedContext(this.context,this.qGraph);\n    }\n  }\n  article(predicate,object){\n    if (object[0].match(/[AEHIOU]/)){\n      if (predicate.match(/ A$/)){\n        predicate += 'n';\n      }\n    }\n    return predicate;\n  }\n  getPredicate(predicate){\n    return this.predicates?this.predicates.find((predicate)=>predicate === predicate.s):null;\n  }\n  getPreferredClasses(context=this.context){\n    if (!this.g){return []}\n    if (!context){return []}\n    //if (this.g.hasOwnProperty(context)){return []}\n    let contextClass = this.g[context]['rdf:type'][0].value;\n    console.log(contextClass);\n\n    let preferredProperties = this.g[contextClass].hasOwnProperty('class:hasPreferredProperty')?this.g[contextClass]['class:hasPreferredProperty']:[];\n    console.log(preferredProperties);\n    let childPrefixes = preferredProperties.map((property)=>property.value.split(':')[0]);\n    console.log(childPrefixes);\n    let childClasses = childPrefixes.map((childPrefix)=>this.instanceList['class:_Class']['rdf:type'].filter((childClass)=>childClass.prefix === childPrefix));\n    console.log(childClasses);\n    this.preferredClasses = childClasses[0];\n/*    if (preferredProperty !=''){\n      this.preferredProperty = preferredProperty;\n      let prefix = preferredProperty.split(/:/)[0];\n      console.log(prefix)\n      //console.log(Array.from(this.instanceList['class:_Class']['rdf:type']));\n      let classInstances = Array.from(this.instanceList['class:_Class']['rdf:type']).filter((instance)=>instance.prefix === prefix);\n      console.log(classInstances);\n      return classInstances\n    }\n    else return []  */\n  }\n    loadMenu(context,selector){\n      let path = `/lib/menu.sjs?context=${context}&predicate=menuItem:hasParentMenuItem&sort=sortMode:_OrdinalAsc&transitive=plus&pageSize=100`;\n    window.fetch(path)\n      .then((response)=>response.json())\n      .then((json)=>{\n        let menu = json.data;\n        let html = this.traverseMenu(menu,context);\n        html = html.replace(/<ul><\\/ul>/g,'');\n        let mainMenu = document.querySelector(selector);\n        mainMenu.innerHTML = html;\n      })\n      .catch((error)=>console.log(error))\n    }\n    traverseMenu(menu,context,level=0){\n      let subMenus = menu.filter((menuItem)=>menuItem.object === context);\n      return subMenus.length>0?`<ul>${subMenus.map((menuItem)=>`<li class=\"menuItem level${level}\"><div class=\"link\" onclick=\"window.app.selectMenuItem('${menuItem.target}')\"\n        title=\"${menuItem.description}\">${menuItem.linkLabel}</div>${this.traverseMenu(menu,menuItem.link,level+1)}</li>`).join('\\n')}</ul>`:'';\n    }\n    selectMenuItem(context){\n      if (context != \"\"){this.fetchContext(context,'card')};\n      this.showMenu = false;\n    }\n    convertToRichText(){\n      let editor = document.querySelector('.bodyEditor');\n      editor.innerHTML = editor.textContent;  \n      this.activeCard.body = editor.innerHTML;    \n    }\n    convertFromRichText(){\n      let editor = document.querySelector('.bodyEditor');\n      editor.textContent = editor.innerHTML;      \n      this.activeCard.body = editor.innerHTML;\n    }\n\n    getVideoId(url) {\n      var regExpYouTube = /^.*(youtu.be\\/|v\\/|u\\/\\w\\/|embed\\/|watch\\?v=|\\&v=)([^#\\&\\?]*).*/;\n      var regExpVimeo = /^.*(vimeo\\.com)\\/(.+$)/\n\n      var match = url.match(regExpYouTube);\n\n      if (match && match[2].length == 11) {\n          return {id:match[2],type:\"youtube\"};\n      } else {\n      match = url.match(regExpVimeo)  \n      if (match){\n        return {id:match[2],type:\"vimeo\"};\n\n      }\n      else\n\n       {\n          return {type:'error'};\n      }\n  }}\n   generateVideoLink(url){\n     var video = this.getVideoId(url);\n\n     if (video.type != 'error'){\n        if (video.type === \"youtube\") {return `<iframe width=\"640\" height=\"480\" src=\"//www.youtube.com/embed/${video.id}\" frameborder=\"0\" allowfullscreen></iframe>`; }\n        if (video.type === \"vimeo\") {return `<iframe width=\"640\" height=\"480\" src=\"//player.vimeo.com/video/${video.id}\" frameborder=\"0\" allowfullscreen></iframe>`; }\n\n        }\n      else {return \"\"}   \n    }\n    validateUserContext(){\n      let role = this.loginData?this.loginData.data?this.loginData.data.hasOwnProperty('user:hasUserRole')?this.loginData.data['user:hasUserRole'][0].value:\"\":\"\":\"\";\n      console.log(role);\n      switch(role){\n        case \"userRole:_Admin\":this.userValidated=true;break;\n        case \"userRole:_DataSteward\":{\n          let typeClass = this.g[this.context]['rdf:type'][0].value;\n          this.userValidated = this.loginData.data.hasOwnProperty('user:hasEditClass')?this.loginData.data['user:hasEditClass'].find((editClass)=>editClass.value === typeClass ||editClass.value === this.context)!=null:false;\n          };break;\n        default: this.userValidated = false;\n      }\n    }\n    classify(){\n      let message = {context:this.context,description:this.activeCard.body,uid:this.loginData.context};\n      console.log(message);\n      let path = `${this.server}/lib/enrich.sjs`;\n      let options = {\"method\":\"POST\",body:JSON.stringify(message,null,4)}\n      window.fetch(path,options)\n      .then((resp)=>resp.json())\n      .then((json)=>{\n          console.log(json);\n          this.activeCard.body=json.description;\n          let topics = json.topics;\n          console.log(topics)\n          let context = this.context;\n          topics.forEach((topic)=>{\n            let predicate = topic.predicate;\n            let curie = topic.curie;\n            let doesPredicateExist = this.g[this.context].hasOwnProperty(predicate);\n            let obj = {type:\"uri\",value:curie}\n            if (predicate != null){\n           if (Array.isArray(this.g[context][predicate])){this.g[context][predicate].push(obj)}\n          else {this.g[context][predicate]=[obj]}\n        }\n          })\n        })\n      .catch((e)=>console.log(e))\n    }\n    getPage(){\n      let url = prompt(\"Enter page URL\");\n      let path = `/lib/getPage.sjs?url=${url}`;\n      fetch(path)\n      .then((resp) => resp.text())\n      .then((text) => {\n          console.log(text);\n          let dom = (new DOMParser()).parseFromString(text,'text/html');\n          let meta = {}\n          Array.from(dom.querySelectorAll('meta[property]')).map((metaElt)=>{\n            let property = metaElt.getAttribute('property');\n            let content = metaElt.getAttribute('content');\n            if (meta.hasOwnProperty(property)){\n              if (!Array.isArray(meta[property])){\n                meta[property] = [meta[property]]\n              }\n              meta[property].push(content)\n            }\n            else {\n              meta[property] = content\n            }\n          });\n          if (url.match(/instagram\\.com/)){\n              this.activeCard.title = meta['og:title'].replace(/<.+?>/g,' ').replace(/\\s+/g,' ');\n              this.activeCard.curie = 'webPost:_'+meta['og:url'].replace(/[^A-Za-z0-9]/g,'').replace(/\\:/g,'');\n              this.activeCard.type = 'class:_WebPost';\n              this.activeCard.image = meta['og:image'];\n              this.activeCard.body = meta['og:description'];\n              this.activeCard.externalURL = meta['og:url'];\n              if (meta.hasOwnProperty('instapp:hashtags')){this.activeCard.body += '<br/>'+meta['instapp:hashtags'].map((hashtag)=>`#${hashtag}`).join(' ');}\n              this.activeCard.body += `<br/><br/><b>Social Media Site:</b> Instagram<br/>`;\n            }\n          if (url.match(/pinterest\\.com/)){\n              this.activeCard.title = meta['og:title'].replace(/<.+?>/g,' ').replace(/\\s+/g,' ');\n              this.activeCard.curie = 'webPost:_'+meta['og:url'].replace(/[^A-Za-z0-9]/g,'').replace(/\\:/g,'');\n              this.activeCard.type = 'class:_WebPost';\n              this.activeCard.image = meta['og:image'];\n              this.activeCard.body = meta['og:description'];\n              this.activeCard.externalURL = meta['og:url'];\n              //this.activeCard.body += '<br/>'+meta['instapp:hashtags'].map((hashtag)=>`#${hashtag}`).join(' ');\n              this.activeCard.body += `<br/><br/><b>Social Media Site:</b> Pinterest<br/>`;\n            }\n            else {\n                let xp = new XPath(dom);\n                this.activeCard.title = xp.getNodes(\"//title\")[0].textContent.trim();\n                this.activeCard.body = Array.from(dom.querySelectorAll('BODY>*:not(SCRIPT)')).map((node)=>node.outerHTML).join('\\n');\n                //xp.getNodes(\"//BODY/*\").map((node)=>node.outerHTML).join('\\n');\n                this.activeCard.image = meta['og:image'];\n                this.activeCard.externalURL = url;\n                this.generateEntityId(this.context);\n//                console.log(this.activeCard);\n            }\n          console.log(meta);\n      })\n      .catch((e)=>console.log(e))\n    }\n    async getFileAsync(url){\n//      let url = \"https://medium.com/@joshgans/a-war-footing-surfing-the-curve-f5ffe6134e37\";\n      let path = `/lib/getPage.sjs?url=${url}`\n      let resp = await window.fetch(path,{method:\"GET\",mode:\"cors\"});\n      let docText = await resp.text();\n      return docText;\n    }\n    async getWebPage(){\n      let url = prompt(\"Paste in URL of web page to load.\");\n      if (url){\n        let html = await this.getFileAsync(url);\n        let dom = (new DOMParser()).parseFromString(html,\"text/html\");\n        let xp = new XPath(dom);\n        this.activeCard.title = xp.getNodes(\"//title\")[0].textContent;\n        this.activeCard.body = xp.getNodes(\"//BODY/*\").map((node)=>node.outerHTML).join('\\n');\n      }\n    }\n}\n\n","\r\n// A ValueConverter for iterating an Object's properties inside of a repeat.for in Aurelia\r\nexport class SortedObjectKeysValueConverter {\r\n    toView(obj) {\r\n        // Create a temporary array to populate with object keys\r\n        let temp = [];\r\n        \r\n        // A basic for..in loop to get object properties\r\n        // https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Statements/for...in\r\n        for (let prop in obj) {\r\n            if (obj.hasOwnProperty(prop)) {\r\n                temp.push(prop);\r\n            }\r\n        }\r\n        temp.sort();\r\n        return temp;\r\n    }\r\n}\r\n\r\n/**\r\n * Usage\r\n * Shows how to use the custom ValueConverter to iterate an objects properties\r\n * aka its keys.\r\n * \r\n * <require from=\"ObjectKeys\"></require>\r\n * <li repeat.for=\"prop of myVmObject | objectKeys\">${prop}</li>\r\n */","\r\n// A ValueConverter for iterating an Object's properties inside of a repeat.for in Aurelia\r\nexport class ObjectKeysValueConverter {\r\n    toView(obj) {\r\n        // Create a temporary array to populate with object keys\r\n        let temp = [];\r\n        \r\n        // A basic for..in loop to get object properties\r\n        // https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Statements/for...in\r\n        for (let prop in obj) {\r\n            if (obj.hasOwnProperty(prop)) {\r\n                temp.push(prop);\r\n            }\r\n        }\r\n        \r\n        return temp;\r\n    }\r\n}\r\n\r\n/**\r\n * Usage\r\n * Shows how to use the custom ValueConverter to iterate an objects properties\r\n * aka its keys.\r\n * \r\n * <require from=\"ObjectKeys\"></require>\r\n * <li repeat.for=\"prop of myVmObject | objectKeys\">${prop}</li>\r\n */"],"sourceRoot":".."}